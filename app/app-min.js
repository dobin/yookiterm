"use strict";angular.module("myApp",["ngRoute","hljs","angularSpinners","ui.bootstrap","myApp.version","myApp.challenge","myApp.container","myApp.setting","myApp.authentication","myApp.staticpages","myApp.admin"]).config(["$locationProvider","$routeProvider","$httpProvider","hljsServiceProvider",function(a,b,c,d){d.setOptions({tabReplace:"    "}),hljs.initHighlighting(),c.defaults.cache=!0,b.otherwise({redirectTo:"/staticpages/index"})}]).run(["$rootScope","AuthenticationServices",function(a,b){b.useToken()}]).controller("menuCtrl",["$scope","AuthenticationServices",function(a,b){if(a.isAuthenticated=!1,b.isAuthenticated()){a.isAuthenticated=!0;var c=b.parseJwt(b.getToken());a.loggedinUser=c.userId,a.isAdmin=c.admin}}]),angular.module("myApp.admin",["ngRoute"]).config(["$routeProvider",function(a){"ngInject";a.when("/admin",{title:"Admin",templateUrl:"modules/admin/admin.html",controller:"adminPageCtrl"})}]).controller("adminPageCtrl",["$scope","$window","$routeParams","$filter","$location","AdminServices","ContainerServices",function(a,b,c,d,e,f,g){"ngInject";a.output="",a.adminCmd=function(b){g.adminCmd(b).then(function(b){for(var c=[],d=0;d<b.length;d++)b[d].data.error.Stderr&&(b[d].data.error.Stderr=btoa(b[d].data.error.Stderror)),c.push(b[d].data);a.output=JSON.stringify(c)})}}]),angular.module("myApp.admin").factory("AdminServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e}]),angular.module("myApp.authentication",["ngRoute"]).config(["$routeProvider",function(a){a.when("/authentication/login",{title:"Authentication",templateUrl:"modules/authentication/authentication.html",controller:"authenticationPageCtrl"})}]).controller("authenticationPageCtrl",["$scope","$window","$routeParams","$filter","$location","AuthenticationServices",function(a,b,c,d,e,f){"ngInject";a.error="",a.loading=!1,a.isAuthed=function(){return!1},a.login=function(){a.loading=!0,f.login(a.username,a.password).then(function(c){1==c.data.authenticated?(a.error="",a.loading=!1,f.saveToken(c.data.token),a.error="Authentication successful",b.location="/"):(a.error="Username or password is incorrect",a.loading=!1)})}}]),angular.module("myApp.authentication").factory("AuthenticationServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e.login=function(b,c){return a.post(d.getSrvUrl()+"/1.0/get-token",{UserId:b,Password:c})},e.saveToken=function(a){localStorage.jwtToken=a,e.useToken()},e.useToken=function(b){e.isAuthenticated&&(a.defaults.headers.common.Authorization="Bearer "+e.getToken())},e.getToken=function(){return localStorage.jwtToken},e.logout=function(){localStorage.removeItem("jwtToken")},e.parseJwt=function(a){var b=a.split(".")[1],c=b.replace("-","+").replace("_","/");return JSON.parse(atob(c))},e.isAuthenticated=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return Math.round((new Date).getTime()/1e3)<=b.exp}return!1},e.isAdmin=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return b.admin}return!1},e}]),angular.module("myApp.challenge",["ngRoute","ngSanitize","hljs"]).config(["$routeProvider",function(a){a.when("/challenges",{title:"challenges",templateUrl:"modules/challenge/challenge-list.html",controller:"challengeListCtrl",resolve:{challenges:["ChallengeServices",function(a){return a.getChallenges()}]}}).when("/challenge/:challengeId",{title:"challenge",templateUrl:"modules/challenge/challenge-view.html",controller:"challengeViewCtrl",resolve:{challenge:["ChallengeServices","$route",function(a,b){return a.getChallenge(b.current.params.challengeId)}]}})}]).controller("challengeListCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","challenges",function(a,b,c,d,e,f,g){"ngInject";a.challenges=g.data}]).controller("challengeViewCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","$sce","spinnerService","ContainerServices","AuthenticationServices","challenge",function(a,b,c,d,e,f,g,h,i,j,k){"ngInject";k=k.data,a.challenge=k,a.showAddTerminalButton=!0,a.isAdmin=j.isAdmin(),a.terminals=[];var l=0;a.showContainerInfo=function(){i.getContainerInfo(k.ContainerBaseName,k.ContainerHostAlias).then(function(b){a.containerInfo=b.data})},a.closeTextTab=function(){console.log("Close")},a.flipTabs=function(){console.log("Flip")},a.stopContainer=function(){i.stopContainer(a.challenge.ContainerHostAlias,a.challenge.ContainerBaseName)},a.incSize=function(a){a.height++,a.term.resize(a.width,a.height)},a.decSize=function(a){a.height--,a.term.resize(a.width,a.height)},a.reload=function(b){a.terminals[b.id-1].term.destroy(),a.getTerminal(b)},a.getTerminal=function(b){if(3!=l){var c,d={height:25,width:null,id:null,term:null};b?c=b.id:(l++,d.id=l,c=a.terminals.push(d),a.showAddTerminalButton=!1),h.show("booksSpinner"),i.startContainerIfNecessary(k.ContainerHostAlias,k.ContainerBaseName).then(function(b){a.terminals[c-1].term=i.getTerminal(d.height),a.terminals[c-1].term.open(document.getElementById("console"+c));var e=a.terminals[c-1].term.proposeGeometry(),f=e.cols,g=e.rows;a.terminals[c-1].width=f,i.getWebsocketTerminal(a.terminals[c-1].term,k.ContainerHostAlias,k.ContainerBaseName,f,g),a.terminals[c-1].term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminals[c-1].term.on("resize",function(a){a.cols,a.rows})}).finally(function(){a.terminals[c-1].term.fit(),h.hide("booksSpinner"),a.showAddTerminalButton=!0})}}}]).directive("mymarkdown",function(){return function(a,b,c){a.$watch("challenge",function(a){$("pre code").each(function(a,b){hljs.highlightBlock(b)})})}}),angular.module("myApp.challenge").factory("ChallengeServices",["$http","$q","$timeout","$cacheFactory","SettingServices","ContainerServices",function(a,b,c,d,e,f){var g={};return g.getChallenge=function(b){return a.get(e.getSrvApiUrl()+"/challenge/"+b).success(function(a){var b=new showdown.Converter;return a.inputHtml=b.makeHtml(a.Text),a})},g.getChallenges=function(){return a.get(e.getSrvApiUrl()+"/challenges")},g}]),angular.module("myApp.container",["ngRoute"]).config(["$routeProvider",function(a){a.when("/container/:containerName",{title:"Container",templateUrl:"modules/container/container.html",controller:"containerPageCtrl"}).when("/container",{title:"Container",templateUrl:"modules/container/container-list.html",controller:"containerListCtrl",resolve:{baseContainers:["ContainerServices",function(a){return a.getBaseContainerList()}],containers:["ContainerServices",function(a){return a.getContainerList()}]}}).when("/container/:containerHostAlias/:containerBaseName/console",{title:"Container Console",templateUrl:"modules/container/container-console.html",controller:"containerConsoleCtrl"})}]).controller("containerConsoleCtrl",["$scope","$routeParams","$filter","$location","$route","ContainerServices",function(a,b,c,d,e,f){"ngInject";var g=e.current.params.containerHostAlias,h=e.current.params.containerBaseName;f.getHostnameForAlias(g).then(function(a){a.Hostname});var i={height:25,width:80,id:null,term:null};a.terminal=i,a.showAddTerminalButton=!1,f.startContainerIfNecessary(g,h).then(function(b){a.terminal.term=f.getTerminal(i.height),a.terminal.term.open(document.getElementById("console"));var c=a.terminal.term.proposeGeometry(),d=c.cols,e=c.rows;a.terminal.width=80,f.getWebsocketTerminal(a.terminal.term,g,h,d,e),a.terminal.term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminal.term.on("resize",function(a){a.cols,a.rows})}).finally(function(){})}]).controller("containerPageCtrl",["$scope","$routeParams","$filter","$location","ContainerServices",function(a,b,c,d,e){}]).controller("containerListCtrl",["$scope","$routeParams","$filter","$location","$window","ContainerServices","baseContainers","containers",function(a,b,c,d,e,f,g,h){"ngInject";a.baseContainers=g.data,a.containers=h,a.startContainer=function(b){f.startContainerIfNecessary(b.ContainerHost.HostnameAlias,b.ContainerBaseName).then(function(c){for(var d=0;d<a.containers.length;d++)a.containers[d]==b&&(a.containers[d].ContainerUsername=c.data.username,a.containers[d].ContainerPassword=c.data.password,a.containers[d].ContainerExpiry=c.data.expiry,a.containers[d].ContainerStatus=c.data.status)})},a.startConsole=function(a){var b=d.protocol()+"://"+d.host()+":"+d.port();b+="#/container/"+a.ContainerHost.HostnameAlias+"/"+a.BaseContainer.Name+"/console",e.open(b,"_blank")}}]),angular.module("myApp.container").factory("ContainerServices",["$http","$q","$timeout","$cacheFactory","SettingServices","AuthenticationServices",function(a,b,c,d,e,f){var g={};return d("containerServiceCache"),g.getBaseContainerList=function(){var b=e.getSrvApiUrl()+"/baseContainers";return a.get(b)},g.getContainerHostList=function(){var b=e.getSrvApiUrl()+"/containerHosts";return a.get(b)},g.getContainerList=function(){return g.getContainerHostList().then(function(c){var d=c.data;return g.getBaseContainerList().then(function(c){var e=c.data,f=d.map(function(b){var c="//"+b.Hostname+"/1.0/container";return a.get(c).then(function(a){if(a.data)for(var c=0;c<a.data.length;c++)a.data[c].ContainerHost=b,a.data[c].BaseContainer=_.findWhere(e,{Name:a.data[c].ContainerBaseName}),a.data[c].ContainerHostAlias=a.data[c].ContainerHost.HostnameAlias;return a.data},function(a){console.log("BLA")})});return b.all(f).then(function(a){for(var b=[],c=0;c<a.length;c++)if(null!=a[c])for(var f=0;f<a[c].length;f++)b.push(a[c][f]);for(var g=0;g<d.length;g++)for(var c=0;c<e.length;c++)_.findWhere(b,{ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name})||b.push({ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name,ContainerHost:d[g],BaseContainer:e[c]});return b},function(a){console.log("BLaA")})})})},g.adminCmd=function(c){return g.getContainerHostList().then(function(d){var e=d.data,f=e.map(function(b){var d="//"+b.Hostname+"/1.0/admin/exec/"+c;return a.get(d)});return b.all(f)})},g.getHostnameForAlias=function(b){var c=e.getSrvApiUrl()+"/containerHosts";return a.get(c).then(function(a){var c=a.data,d=_.findWhere(c,{HostnameAlias:b});return d})},g.startContainerIfNecessary=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d=b,e="//"+d.Hostname+"/1.0/container/"+c+"/start";return a.get(e)})},g.stopContainer=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d="//"+b.Hostname+"/1.0/container/"+c+"/stop";return a.get(d)})},g.getContainerInfo=function(b,c){return g.getHostnameForAlias(c).then(function(c){var d="//"+c.Hostname+"/1.0/container/"+b;return a.get(d)})},g.getTerminal=function(a){var b=new Terminal({cols:80,rows:a,useStyle:!0,screenKeys:!1,cursorBlink:!1});return b},g.getWebsocketTerminal=function(a,b,c,d,e){return g.getHostnameForAlias(b).then(function(b){var g,h=b;g="https:"===location.protocol?"wss://":"ws://";var i=g+h.Hostname+"/1.0/container/"+c+"/console?width="+d+"&height="+e+"&token="+f.getToken(),j=new WebSocket(i);a.on("data",function(a){j.send(btoa(a))}),j.onopen=function(b){j.onmessage=function(b){var c=atob(b.data);a.write(c)},j.onclose=function(b){console.log("WebSocket closed"),a.destroy()},j.onerror=function(a){console.error(a)}}})},g}]),angular.module("myApp.setting",["ngRoute"]).config(["$routeProvider",function(a){a.when("/settings",{title:"Settings",templateUrl:"modules/setting/settings.html",controller:"settingListCtrl",resolve:{myconfig:["SettingServices","$route",function(a,b){return a.getMyCfg()}]}})}]).controller("settingListCtrl",["$http","$scope","$routeParams","$route","$filter","$location","$uibModal","$window","SettingServices","myconfig",function(a,b,c,d,e,f,g,h,i,j){b.myconfig=j,b.test={},b.testUrl=i.getLxdApiUrl(),i.getConfig().then(function(a){b.config=a.data.metadata},function(a){b.errMsg="Could not get config from server: "+i.getLxdUrl()}),b.save=function(){i.setMyCfg(b.myconfig),d.reload()}}]),angular.module("myApp.setting").factory("SettingServices",["$http","$q","$timeout",function(a,b,c){var d={};return d.getMyCfg=function(){var a;a="localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost:8090":"exploit.courses";var b={srvurl:a};return b},d.setMyCfg=function(a){localStorage.setItem("lxdcfg",JSON.stringify(a))},d.getSrvUrl=function(){return"//"+d.getMyCfg().srvurl},d.getSrvApiUrl=function(){return"//"+d.getMyCfg().srvurl+"/1.0"},d}]),angular.module("myApp.staticpages",["ngRoute"]).config(["$routeProvider",function(a){a.when("/staticpages/index",{title:"Staticpages",templateUrl:"modules/staticpages/index.html",controller:"staticpagesIndexCtrl"})}]).controller("staticpagesIndexCtrl",["$scope","$window","$routeParams","$filter","$location",function(a,b,c,d,e){}]),angular.module("myApp",["ngRoute","hljs","angularSpinners","ui.bootstrap","myApp.version","myApp.challenge","myApp.container","myApp.setting","myApp.authentication","myApp.staticpages","myApp.admin"]).config(["$locationProvider","$routeProvider","$httpProvider","hljsServiceProvider",function(a,b,c,d){d.setOptions({tabReplace:"    "}),hljs.initHighlighting(),c.defaults.cache=!0,b.otherwise({redirectTo:"/staticpages/index"})}]).run(["$rootScope","AuthenticationServices",function(a,b){b.useToken()}]).controller("menuCtrl",["$scope","AuthenticationServices",function(a,b){if(a.isAuthenticated=!1,b.isAuthenticated()){a.isAuthenticated=!0;var c=b.parseJwt(b.getToken());a.loggedinUser=c.userId,a.isAdmin=c.admin}}]),angular.module("myApp.admin",["ngRoute"]).config(["$routeProvider",function(a){"ngInject";a.when("/admin",{title:"Admin",templateUrl:"modules/admin/admin.html",controller:"adminPageCtrl"})}]).controller("adminPageCtrl",["$scope","$window","$routeParams","$filter","$location","AdminServices","ContainerServices",function(a,b,c,d,e,f,g){"ngInject";a.output="",a.adminCmd=function(b){g.adminCmd(b).then(function(b){for(var c=[],d=0;d<b.length;d++)b[d].data.error.Stderr&&(b[d].data.error.Stderr=btoa(b[d].data.error.Stderror)),c.push(b[d].data);a.output=JSON.stringify(c)})}}]),angular.module("myApp.admin").factory("AdminServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e}]),angular.module("myApp.authentication",["ngRoute"]).config(["$routeProvider",function(a){a.when("/authentication/login",{title:"Authentication",templateUrl:"modules/authentication/authentication.html",controller:"authenticationPageCtrl"})}]).controller("authenticationPageCtrl",["$scope","$window","$routeParams","$filter","$location","AuthenticationServices",function(a,b,c,d,e,f){"ngInject";a.error="",a.loading=!1,a.isAuthed=function(){return!1},a.login=function(){a.loading=!0,f.login(a.username,a.password).then(function(c){1==c.data.authenticated?(a.error="",a.loading=!1,f.saveToken(c.data.token),a.error="Authentication successful",b.location="/"):(a.error="Username or password is incorrect",a.loading=!1)})}}]),angular.module("myApp.authentication").factory("AuthenticationServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e.login=function(b,c){return a.post(d.getSrvUrl()+"/1.0/get-token",{UserId:b,Password:c})},e.saveToken=function(a){localStorage.jwtToken=a,e.useToken()},e.useToken=function(b){e.isAuthenticated&&(a.defaults.headers.common.Authorization="Bearer "+e.getToken())},e.getToken=function(){return localStorage.jwtToken},e.logout=function(){localStorage.removeItem("jwtToken")},e.parseJwt=function(a){var b=a.split(".")[1],c=b.replace("-","+").replace("_","/");return JSON.parse(atob(c))},e.isAuthenticated=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return Math.round((new Date).getTime()/1e3)<=b.exp}return!1},e.isAdmin=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return b.admin}return!1},e}]),angular.module("myApp.challenge",["ngRoute","ngSanitize","hljs"]).config(["$routeProvider",function(a){a.when("/challenges",{title:"challenges",templateUrl:"modules/challenge/challenge-list.html",controller:"challengeListCtrl",resolve:{challenges:["ChallengeServices",function(a){return a.getChallenges()}]}}).when("/challenge/:challengeId",{title:"challenge",templateUrl:"modules/challenge/challenge-view.html",controller:"challengeViewCtrl",resolve:{challenge:["ChallengeServices","$route",function(a,b){return a.getChallenge(b.current.params.challengeId)}]}})}]).controller("challengeListCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","challenges",function(a,b,c,d,e,f,g){"ngInject";a.challenges=g.data}]).controller("challengeViewCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","$sce","spinnerService","ContainerServices","AuthenticationServices","challenge",function(a,b,c,d,e,f,g,h,i,j,k){"ngInject";k=k.data,a.challenge=k,a.showAddTerminalButton=!0,a.isAdmin=j.isAdmin(),a.terminals=[];var l=0;a.showContainerInfo=function(){i.getContainerInfo(k.ContainerBaseName,k.ContainerHostAlias).then(function(b){a.containerInfo=b.data})},a.closeTextTab=function(){console.log("Close")},a.flipTabs=function(){console.log("Flip")},a.stopContainer=function(){i.stopContainer(a.challenge.ContainerHostAlias,a.challenge.ContainerBaseName)},a.incSize=function(a){a.height++,a.term.resize(a.width,a.height)},a.decSize=function(a){a.height--,a.term.resize(a.width,a.height)},a.reload=function(b){a.terminals[b.id-1].term.destroy(),a.getTerminal(b)},a.getTerminal=function(b){if(3!=l){var c,d={height:25,width:null,id:null,term:null};b?c=b.id:(l++,d.id=l,c=a.terminals.push(d),a.showAddTerminalButton=!1),h.show("booksSpinner"),i.startContainerIfNecessary(k.ContainerHostAlias,k.ContainerBaseName).then(function(b){a.terminals[c-1].term=i.getTerminal(d.height),a.terminals[c-1].term.open(document.getElementById("console"+c));var e=a.terminals[c-1].term.proposeGeometry(),f=e.cols,g=e.rows;a.terminals[c-1].width=f,i.getWebsocketTerminal(a.terminals[c-1].term,k.ContainerHostAlias,k.ContainerBaseName,f,g),a.terminals[c-1].term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminals[c-1].term.on("resize",function(a){a.cols,a.rows})}).finally(function(){a.terminals[c-1].term.fit(),h.hide("booksSpinner"),a.showAddTerminalButton=!0})}}}]).directive("mymarkdown",function(){return function(a,b,c){a.$watch("challenge",function(a){$("pre code").each(function(a,b){hljs.highlightBlock(b)})})}}),angular.module("myApp.challenge").factory("ChallengeServices",["$http","$q","$timeout","$cacheFactory","SettingServices","ContainerServices",function(a,b,c,d,e,f){var g={};return g.getChallenge=function(b){return a.get(e.getSrvApiUrl()+"/challenge/"+b).success(function(a){var b=new showdown.Converter;return a.inputHtml=b.makeHtml(a.Text),a})},g.getChallenges=function(){return a.get(e.getSrvApiUrl()+"/challenges")},g}]),angular.module("myApp.container",["ngRoute"]).config(["$routeProvider",function(a){a.when("/container/:containerName",{title:"Container",templateUrl:"modules/container/container.html",controller:"containerPageCtrl"}).when("/container",{title:"Container",templateUrl:"modules/container/container-list.html",controller:"containerListCtrl",resolve:{baseContainers:["ContainerServices",function(a){return a.getBaseContainerList()}],containers:["ContainerServices",function(a){return a.getContainerList()}]}}).when("/container/:containerHostAlias/:containerBaseName/console",{title:"Container Console",templateUrl:"modules/container/container-console.html",controller:"containerConsoleCtrl"})}]).controller("containerConsoleCtrl",["$scope","$routeParams","$filter","$location","$route","ContainerServices",function(a,b,c,d,e,f){"ngInject";var g=e.current.params.containerHostAlias,h=e.current.params.containerBaseName;f.getHostnameForAlias(g).then(function(a){a.Hostname});var i={height:25,width:80,id:null,term:null};a.terminal=i,a.showAddTerminalButton=!1,f.startContainerIfNecessary(g,h).then(function(b){a.terminal.term=f.getTerminal(i.height),a.terminal.term.open(document.getElementById("console"));var c=a.terminal.term.proposeGeometry(),d=c.cols,e=c.rows;a.terminal.width=80,f.getWebsocketTerminal(a.terminal.term,g,h,d,e),a.terminal.term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminal.term.on("resize",function(a){a.cols,a.rows})}).finally(function(){})}]).controller("containerPageCtrl",["$scope","$routeParams","$filter","$location","ContainerServices",function(a,b,c,d,e){}]).controller("containerListCtrl",["$scope","$routeParams","$filter","$location","$window","ContainerServices","baseContainers","containers",function(a,b,c,d,e,f,g,h){"ngInject";a.baseContainers=g.data,a.containers=h,a.startContainer=function(b){f.startContainerIfNecessary(b.ContainerHost.HostnameAlias,b.ContainerBaseName).then(function(c){for(var d=0;d<a.containers.length;d++)a.containers[d]==b&&(a.containers[d].ContainerUsername=c.data.username,a.containers[d].ContainerPassword=c.data.password,a.containers[d].ContainerExpiry=c.data.expiry,a.containers[d].ContainerStatus=c.data.status)})},a.startConsole=function(a){var b=d.protocol()+"://"+d.host()+":"+d.port();b+="#/container/"+a.ContainerHost.HostnameAlias+"/"+a.BaseContainer.Name+"/console",e.open(b,"_blank")}}]),angular.module("myApp.container").factory("ContainerServices",["$http","$q","$timeout","$cacheFactory","SettingServices","AuthenticationServices",function(a,b,c,d,e,f){var g={};return d("containerServiceCache"),g.getBaseContainerList=function(){var b=e.getSrvApiUrl()+"/baseContainers";return a.get(b)},g.getContainerHostList=function(){var b=e.getSrvApiUrl()+"/containerHosts";return a.get(b)},g.getContainerList=function(){return g.getContainerHostList().then(function(c){var d=c.data;return g.getBaseContainerList().then(function(c){var e=c.data,f=d.map(function(b){var c="//"+b.Hostname+"/1.0/container";return a.get(c).then(function(a){if(a.data)for(var c=0;c<a.data.length;c++)a.data[c].ContainerHost=b,a.data[c].BaseContainer=_.findWhere(e,{Name:a.data[c].ContainerBaseName}),a.data[c].ContainerHostAlias=a.data[c].ContainerHost.HostnameAlias;return a.data},function(a){console.log("BLA")})});return b.all(f).then(function(a){for(var b=[],c=0;c<a.length;c++)if(null!=a[c])for(var f=0;f<a[c].length;f++)b.push(a[c][f]);for(var g=0;g<d.length;g++)for(var c=0;c<e.length;c++)_.findWhere(b,{ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name})||b.push({ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name,ContainerHost:d[g],BaseContainer:e[c]});return b},function(a){console.log("BLaA")})})})},g.adminCmd=function(c){return g.getContainerHostList().then(function(d){var e=d.data,f=e.map(function(b){var d="//"+b.Hostname+"/1.0/admin/exec/"+c;return a.get(d)});return b.all(f)})},g.getHostnameForAlias=function(b){var c=e.getSrvApiUrl()+"/containerHosts";return a.get(c).then(function(a){var c=a.data,d=_.findWhere(c,{HostnameAlias:b});return d})},g.startContainerIfNecessary=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d=b,e="//"+d.Hostname+"/1.0/container/"+c+"/start";return a.get(e)})},g.stopContainer=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d="//"+b.Hostname+"/1.0/container/"+c+"/stop";return a.get(d)})},g.getContainerInfo=function(b,c){return g.getHostnameForAlias(c).then(function(c){var d="//"+c.Hostname+"/1.0/container/"+b;return a.get(d)})},g.getTerminal=function(a){var b=new Terminal({cols:80,rows:a,useStyle:!0,screenKeys:!1,cursorBlink:!1});return b},g.getWebsocketTerminal=function(a,b,c,d,e){return g.getHostnameForAlias(b).then(function(b){var g,h=b;g="https:"===location.protocol?"wss://":"ws://";var i=g+h.Hostname+"/1.0/container/"+c+"/console?width="+d+"&height="+e+"&token="+f.getToken(),j=new WebSocket(i);a.on("data",function(a){j.send(btoa(a))}),j.onopen=function(b){j.onmessage=function(b){var c=atob(b.data);a.write(c)},j.onclose=function(b){console.log("WebSocket closed"),a.destroy()},j.onerror=function(a){console.error(a)}}})},g}]),angular.module("myApp.setting",["ngRoute"]).config(["$routeProvider",function(a){a.when("/settings",{title:"Settings",templateUrl:"modules/setting/settings.html",controller:"settingListCtrl",resolve:{myconfig:["SettingServices","$route",function(a,b){return a.getMyCfg()}]}})}]).controller("settingListCtrl",["$http","$scope","$routeParams","$route","$filter","$location","$uibModal","$window","SettingServices","myconfig",function(a,b,c,d,e,f,g,h,i,j){b.myconfig=j,b.test={},b.testUrl=i.getLxdApiUrl(),i.getConfig().then(function(a){b.config=a.data.metadata},function(a){b.errMsg="Could not get config from server: "+i.getLxdUrl()}),b.save=function(){i.setMyCfg(b.myconfig),d.reload()}}]),angular.module("myApp.setting").factory("SettingServices",["$http","$q","$timeout",function(a,b,c){var d={};return d.getMyCfg=function(){var a;a="localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost:8090":"exploit.courses";var b={srvurl:a};return b},d.setMyCfg=function(a){localStorage.setItem("lxdcfg",JSON.stringify(a))},d.getSrvUrl=function(){return"//"+d.getMyCfg().srvurl},d.getSrvApiUrl=function(){return"//"+d.getMyCfg().srvurl+"/1.0"},d}]),angular.module("myApp.staticpages",["ngRoute"]).config(["$routeProvider",function(a){a.when("/staticpages/index",{title:"Staticpages",templateUrl:"modules/staticpages/index.html",controller:"staticpagesIndexCtrl"})}]).controller("staticpagesIndexCtrl",["$scope","$window","$routeParams","$filter","$location",function(a,b,c,d,e){}]),angular.module("myApp",["ngRoute","hljs","angularSpinners","ui.bootstrap","myApp.version","myApp.challenge","myApp.container","myApp.setting","myApp.authentication","myApp.staticpages","myApp.admin"]).config(["$locationProvider","$routeProvider","$httpProvider","hljsServiceProvider",function(a,b,c,d){d.setOptions({tabReplace:"    "}),hljs.initHighlighting(),c.defaults.cache=!0,b.otherwise({redirectTo:"/staticpages/index"})}]).run(["$rootScope","AuthenticationServices",function(a,b){b.useToken()}]).controller("menuCtrl",["$scope","AuthenticationServices",function(a,b){if(a.isAuthenticated=!1,b.isAuthenticated()){a.isAuthenticated=!0;var c=b.parseJwt(b.getToken());a.loggedinUser=c.userId,a.isAdmin=c.admin}}]),angular.module("myApp.admin",["ngRoute"]).config(["$routeProvider",function(a){"ngInject";a.when("/admin",{title:"Admin",templateUrl:"modules/admin/admin.html",controller:"adminPageCtrl"})}]).controller("adminPageCtrl",["$scope","$window","$routeParams","$filter","$location","AdminServices","ContainerServices",function(a,b,c,d,e,f,g){"ngInject";a.output="",a.adminCmd=function(b){g.adminCmd(b).then(function(b){for(var c=[],d=0;d<b.length;d++)b[d].data.error.Stderr&&(b[d].data.error.Stderr=btoa(b[d].data.error.Stderror)),c.push(b[d].data);a.output=JSON.stringify(c)})}}]),angular.module("myApp.admin").factory("AdminServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e}]),angular.module("myApp.authentication",["ngRoute"]).config(["$routeProvider",function(a){a.when("/authentication/login",{title:"Authentication",templateUrl:"modules/authentication/authentication.html",controller:"authenticationPageCtrl"})}]).controller("authenticationPageCtrl",["$scope","$window","$routeParams","$filter","$location","AuthenticationServices",function(a,b,c,d,e,f){"ngInject";a.error="",a.loading=!1,a.isAuthed=function(){return!1},a.login=function(){a.loading=!0,f.login(a.username,a.password).then(function(c){1==c.data.authenticated?(a.error="",a.loading=!1,f.saveToken(c.data.token),a.error="Authentication successful",b.location="/"):(a.error="Username or password is incorrect",a.loading=!1)})}}]),angular.module("myApp.authentication").factory("AuthenticationServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e.login=function(b,c){return a.post(d.getSrvUrl()+"/1.0/get-token",{UserId:b,Password:c})},e.saveToken=function(a){localStorage.jwtToken=a,e.useToken()},e.useToken=function(b){e.isAuthenticated&&(a.defaults.headers.common.Authorization="Bearer "+e.getToken())},e.getToken=function(){return localStorage.jwtToken},e.logout=function(){localStorage.removeItem("jwtToken")},e.parseJwt=function(a){var b=a.split(".")[1],c=b.replace("-","+").replace("_","/");return JSON.parse(atob(c))},e.isAuthenticated=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return Math.round((new Date).getTime()/1e3)<=b.exp}return!1},e.isAdmin=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return b.admin}return!1},e}]),angular.module("myApp.challenge",["ngRoute","ngSanitize","hljs"]).config(["$routeProvider",function(a){a.when("/challenges",{title:"challenges",templateUrl:"modules/challenge/challenge-list.html",controller:"challengeListCtrl",resolve:{challenges:["ChallengeServices",function(a){return a.getChallenges()}]}}).when("/challenge/:challengeId",{title:"challenge",templateUrl:"modules/challenge/challenge-view.html",controller:"challengeViewCtrl",resolve:{challenge:["ChallengeServices","$route",function(a,b){return a.getChallenge(b.current.params.challengeId)}]}})}]).controller("challengeListCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","challenges",function(a,b,c,d,e,f,g){"ngInject";a.challenges=g.data}]).controller("challengeViewCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","$sce","spinnerService","ContainerServices","AuthenticationServices","challenge",function(a,b,c,d,e,f,g,h,i,j,k){"ngInject";k=k.data,a.challenge=k,a.showAddTerminalButton=!0,a.isAdmin=j.isAdmin(),a.terminals=[];var l=0;a.showContainerInfo=function(){i.getContainerInfo(k.ContainerBaseName,k.ContainerHostAlias).then(function(b){a.containerInfo=b.data})},a.closeTextTab=function(){console.log("Close")},a.flipTabs=function(){console.log("Flip")},a.stopContainer=function(){i.stopContainer(a.challenge.ContainerHostAlias,a.challenge.ContainerBaseName)},a.incSize=function(a){a.height++,a.term.resize(a.width,a.height)},a.decSize=function(a){a.height--,a.term.resize(a.width,a.height)},a.reload=function(b){a.terminals[b.id-1].term.destroy(),a.getTerminal(b)},a.getTerminal=function(b){if(3!=l){var c,d={height:25,width:null,id:null,term:null};b?c=b.id:(l++,d.id=l,c=a.terminals.push(d),a.showAddTerminalButton=!1),h.show("booksSpinner"),i.startContainerIfNecessary(k.ContainerHostAlias,k.ContainerBaseName).then(function(b){a.terminals[c-1].term=i.getTerminal(d.height),a.terminals[c-1].term.open(document.getElementById("console"+c));var e=a.terminals[c-1].term.proposeGeometry(),f=e.cols,g=e.rows;a.terminals[c-1].width=f,i.getWebsocketTerminal(a.terminals[c-1].term,k.ContainerHostAlias,k.ContainerBaseName,f,g),a.terminals[c-1].term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminals[c-1].term.on("resize",function(a){a.cols,a.rows})}).finally(function(){a.terminals[c-1].term.fit(),h.hide("booksSpinner"),a.showAddTerminalButton=!0})}}}]).directive("mymarkdown",function(){return function(a,b,c){a.$watch("challenge",function(a){$("pre code").each(function(a,b){hljs.highlightBlock(b)})})}}),angular.module("myApp.challenge").factory("ChallengeServices",["$http","$q","$timeout","$cacheFactory","SettingServices","ContainerServices",function(a,b,c,d,e,f){var g={};return g.getChallenge=function(b){return a.get(e.getSrvApiUrl()+"/challenge/"+b).success(function(a){var b=new showdown.Converter;return a.inputHtml=b.makeHtml(a.Text),a})},g.getChallenges=function(){return a.get(e.getSrvApiUrl()+"/challenges")},g}]),angular.module("myApp.container",["ngRoute"]).config(["$routeProvider",function(a){a.when("/container/:containerName",{title:"Container",templateUrl:"modules/container/container.html",controller:"containerPageCtrl"}).when("/container",{title:"Container",templateUrl:"modules/container/container-list.html",controller:"containerListCtrl",resolve:{baseContainers:["ContainerServices",function(a){return a.getBaseContainerList()}],containers:["ContainerServices",function(a){return a.getContainerList()}]}}).when("/container/:containerHostAlias/:containerBaseName/console",{title:"Container Console",templateUrl:"modules/container/container-console.html",controller:"containerConsoleCtrl"})}]).controller("containerConsoleCtrl",["$scope","$routeParams","$filter","$location","$route","ContainerServices",function(a,b,c,d,e,f){
"ngInject";var g=e.current.params.containerHostAlias,h=e.current.params.containerBaseName;f.getHostnameForAlias(g).then(function(a){a.Hostname});var i={height:25,width:80,id:null,term:null};a.terminal=i,a.showAddTerminalButton=!1,f.startContainerIfNecessary(g,h).then(function(b){a.terminal.term=f.getTerminal(i.height),a.terminal.term.open(document.getElementById("console"));var c=a.terminal.term.proposeGeometry(),d=c.cols,e=c.rows;a.terminal.width=80,f.getWebsocketTerminal(a.terminal.term,g,h,d,e),a.terminal.term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminal.term.on("resize",function(a){a.cols,a.rows})}).finally(function(){})}]).controller("containerPageCtrl",["$scope","$routeParams","$filter","$location","ContainerServices",function(a,b,c,d,e){"ngInject"}]).controller("containerListCtrl",["$scope","$routeParams","$filter","$location","$window","ContainerServices","baseContainers","containers",function(a,b,c,d,e,f,g,h){"ngInject";a.baseContainers=g.data,a.containers=h,a.startContainer=function(b){f.startContainerIfNecessary(b.ContainerHost.HostnameAlias,b.ContainerBaseName).then(function(c){for(var d=0;d<a.containers.length;d++)a.containers[d]==b&&(a.containers[d].ContainerUsername=c.data.username,a.containers[d].ContainerPassword=c.data.password,a.containers[d].ContainerExpiry=c.data.expiry,a.containers[d].ContainerStatus=c.data.status)})},a.startConsole=function(a){var b=d.protocol()+"://"+d.host()+":"+d.port();b+="#/container/"+a.ContainerHost.HostnameAlias+"/"+a.BaseContainer.Name+"/console",e.open(b,"_blank")}}]),angular.module("myApp.container").factory("ContainerServices",["$http","$q","$timeout","$cacheFactory","SettingServices","AuthenticationServices",function(a,b,c,d,e,f){var g={};d("containerServiceCache");return g.getBaseContainerList=function(){var b=e.getSrvApiUrl()+"/baseContainers";return a.get(b)},g.getContainerHostList=function(){var b=e.getSrvApiUrl()+"/containerHosts";return a.get(b)},g.getContainerList=function(){return g.getContainerHostList().then(function(c){var d=c.data;return g.getBaseContainerList().then(function(c){var e=c.data,f=d.map(function(b){var c="//"+b.Hostname+"/1.0/container";return a.get(c).then(function(a){if(a.data)for(var c=0;c<a.data.length;c++)a.data[c].ContainerHost=b,a.data[c].BaseContainer=_.findWhere(e,{Name:a.data[c].ContainerBaseName}),a.data[c].ContainerHostAlias=a.data[c].ContainerHost.HostnameAlias;return a.data},function(a){console.log("BLA")})});return b.all(f).then(function(a){for(var b=[],c=0;c<a.length;c++)if(null!=a[c])for(var f=0;f<a[c].length;f++)b.push(a[c][f]);for(var g=0;g<d.length;g++)for(var c=0;c<e.length;c++)_.findWhere(b,{ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name})||b.push({ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name,ContainerHost:d[g],BaseContainer:e[c]});return b},function(a){console.log("BLaA")})})})},g.adminCmd=function(c){return g.getContainerHostList().then(function(d){var e=d.data,f=e.map(function(b){var d="//"+b.Hostname+"/1.0/admin/exec/"+c;return a.get(d)});return b.all(f)})},g.getHostnameForAlias=function(b){var c=e.getSrvApiUrl()+"/containerHosts";return a.get(c).then(function(a){var c=a.data,d=_.findWhere(c,{HostnameAlias:b});return d})},g.startContainerIfNecessary=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d=b,e="//"+d.Hostname+"/1.0/container/"+c+"/start";return a.get(e)})},g.stopContainer=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d="//"+b.Hostname+"/1.0/container/"+c+"/stop";return a.get(d)})},g.getContainerInfo=function(b,c){return g.getHostnameForAlias(c).then(function(c){var d="//"+c.Hostname+"/1.0/container/"+b;return a.get(d)})},g.getTerminal=function(a){var b=new Terminal({cols:80,rows:a,useStyle:!0,screenKeys:!1,cursorBlink:!1});return b},g.getWebsocketTerminal=function(a,b,c,d,e){return g.getHostnameForAlias(b).then(function(b){var g,h=b;g="https:"===location.protocol?"wss://":"ws://";var i=g+h.Hostname+"/1.0/container/"+c+"/console?width="+d+"&height="+e+"&token="+f.getToken(),j=new WebSocket(i);a.on("data",function(a){j.send(btoa(a))}),j.onopen=function(b){j.onmessage=function(b){var c=atob(b.data);a.write(c)},j.onclose=function(b){console.log("WebSocket closed"),a.destroy()},j.onerror=function(a){console.error(a)}}})},g}]),angular.module("myApp.setting",["ngRoute"]).config(["$routeProvider",function(a){a.when("/settings",{title:"Settings",templateUrl:"modules/setting/settings.html",controller:"settingListCtrl",resolve:{myconfig:["SettingServices","$route",function(a,b){return a.getMyCfg()}]}})}]).controller("settingListCtrl",["$http","$scope","$routeParams","$route","$filter","$location","$uibModal","$window","SettingServices","myconfig",function(a,b,c,d,e,f,g,h,i,j){b.myconfig=j,b.test={},b.testUrl=i.getLxdApiUrl(),i.getConfig().then(function(a){b.config=a.data.metadata},function(a){b.errMsg="Could not get config from server: "+i.getLxdUrl()}),b.save=function(){i.setMyCfg(b.myconfig),d.reload()}}]),angular.module("myApp.setting").factory("SettingServices",["$http","$q","$timeout",function(a,b,c){var d={};return d.getMyCfg=function(){var a;a="localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost:8090":"exploit.courses";var b={srvurl:a};return b},d.setMyCfg=function(a){localStorage.setItem("lxdcfg",JSON.stringify(a))},d.getSrvUrl=function(){return"//"+d.getMyCfg().srvurl},d.getSrvApiUrl=function(){return"//"+d.getMyCfg().srvurl+"/1.0"},d}]),angular.module("myApp.staticpages",["ngRoute"]).config(["$routeProvider",function(a){a.when("/staticpages/index",{title:"Staticpages",templateUrl:"modules/staticpages/index.html",controller:"staticpagesIndexCtrl"})}]).controller("staticpagesIndexCtrl",["$scope","$window","$routeParams","$filter","$location",function(a,b,c,d,e){"ngInject"}]),angular.module("myApp",["ngRoute","hljs","angularSpinners","ui.bootstrap","myApp.version","myApp.challenge","myApp.container","myApp.setting","myApp.authentication","myApp.staticpages","myApp.admin"]).config(["$locationProvider","$routeProvider","$httpProvider","hljsServiceProvider",function(a,b,c,d){d.setOptions({tabReplace:"    "}),hljs.initHighlighting(),c.defaults.cache=!0,b.otherwise({redirectTo:"/staticpages/index"})}]).run(["$rootScope","AuthenticationServices",function(a,b){b.useToken()}]).controller("menuCtrl",["$scope","AuthenticationServices",function(a,b){if(a.isAuthenticated=!1,b.isAuthenticated()){a.isAuthenticated=!0;var c=b.parseJwt(b.getToken());a.loggedinUser=c.userId,a.isAdmin=c.admin}}]),angular.module("myApp.admin",["ngRoute"]).config(["$routeProvider",function(a){"ngInject";a.when("/admin",{title:"Admin",templateUrl:"modules/admin/admin.html",controller:"adminPageCtrl"})}]).controller("adminPageCtrl",["$scope","$window","$routeParams","$filter","$location","AdminServices","ContainerServices",function(a,b,c,d,e,f,g){"ngInject";a.output="",a.adminCmd=function(b){g.adminCmd(b).then(function(b){for(var c=[],d=0;d<b.length;d++)b[d].data.error.Stderr&&(b[d].data.error.Stderr=btoa(b[d].data.error.Stderror)),c.push(b[d].data);a.output=JSON.stringify(c)})}}]),angular.module("myApp.admin").factory("AdminServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e}]),angular.module("myApp.authentication",["ngRoute"]).config(["$routeProvider",function(a){a.when("/authentication/login",{title:"Authentication",templateUrl:"modules/authentication/authentication.html",controller:"authenticationPageCtrl"})}]).controller("authenticationPageCtrl",["$scope","$window","$routeParams","$filter","$location","AuthenticationServices",function(a,b,c,d,e,f){"ngInject";a.error="",a.loading=!1,a.isAuthed=function(){return!1},a.login=function(){a.loading=!0,f.login(a.username,a.password).then(function(c){1==c.data.authenticated?(a.error="",a.loading=!1,f.saveToken(c.data.token),a.error="Authentication successful",b.location="/"):(a.error="Username or password is incorrect",a.loading=!1)})}}]),angular.module("myApp.authentication").factory("AuthenticationServices",["$http","$q","$timeout","SettingServices",function(a,b,c,d){var e={};return e.login=function(b,c){return a.post(d.getSrvUrl()+"/1.0/get-token",{UserId:b,Password:c})},e.saveToken=function(a){localStorage.jwtToken=a,e.useToken()},e.useToken=function(b){e.isAuthenticated&&(a.defaults.headers.common.Authorization="Bearer "+e.getToken())},e.getToken=function(){return localStorage.jwtToken},e.logout=function(){localStorage.removeItem("jwtToken")},e.parseJwt=function(a){var b=a.split(".")[1],c=b.replace("-","+").replace("_","/");return JSON.parse(atob(c))},e.isAuthenticated=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return Math.round((new Date).getTime()/1e3)<=b.exp}return!1},e.isAdmin=function(){var a=e.getToken();if(a){var b=e.parseJwt(a);return b.admin}return!1},e}]),angular.module("myApp.challenge",["ngRoute","ngSanitize","hljs"]).config(["$routeProvider",function(a){a.when("/challenges",{title:"challenges",templateUrl:"modules/challenge/challenge-list.html",controller:"challengeListCtrl",resolve:{challenges:["ChallengeServices",function(a){return a.getChallenges()}]}}).when("/challenge/:challengeId",{title:"challenge",templateUrl:"modules/challenge/challenge-view.html",controller:"challengeViewCtrl",resolve:{challenge:["ChallengeServices","$route",function(a,b){return a.getChallenge(b.current.params.challengeId)}]}})}]).controller("challengeListCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","challenges",function(a,b,c,d,e,f,g){"ngInject";a.challenges=g.data}]).controller("challengeViewCtrl",["$scope","$routeParams","$filter","$location","$route","$interval","$sce","spinnerService","ContainerServices","AuthenticationServices","challenge",function(a,b,c,d,e,f,g,h,i,j,k){"ngInject";k=k.data,a.challenge=k,a.showAddTerminalButton=!0,a.isAdmin=j.isAdmin(),a.terminals=[];var l=0;a.showContainerInfo=function(){i.getContainerInfo(k.ContainerBaseName,k.ContainerHostAlias).then(function(b){a.containerInfo=b.data})},a.closeTextTab=function(){console.log("Close")},a.flipTabs=function(){console.log("Flip")},a.stopContainer=function(){i.stopContainer(a.challenge.ContainerHostAlias,a.challenge.ContainerBaseName)},a.incSize=function(a){a.height++,a.term.resize(a.width,a.height)},a.decSize=function(a){a.height--,a.term.resize(a.width,a.height)},a.reload=function(b){a.terminals[b.id-1].term.destroy(),a.getTerminal(b)},a.getTerminal=function(b){if(3!=l){var c,d={height:25,width:null,id:null,term:null};b?c=b.id:(l++,d.id=l,c=a.terminals.push(d),a.showAddTerminalButton=!1),h.show("booksSpinner"),i.startContainerIfNecessary(k.ContainerHostAlias,k.ContainerBaseName).then(function(b){a.terminals[c-1].term=i.getTerminal(d.height),a.terminals[c-1].term.open(document.getElementById("console"+c));var e=a.terminals[c-1].term.proposeGeometry(),f=e.cols,g=e.rows;a.terminals[c-1].width=f,i.getWebsocketTerminal(a.terminals[c-1].term,k.ContainerHostAlias,k.ContainerBaseName,f,g),a.terminals[c-1].term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminals[c-1].term.on("resize",function(a){a.cols,a.rows})}).finally(function(){a.terminals[c-1].term.fit(),h.hide("booksSpinner"),a.showAddTerminalButton=!0})}}}]).directive("mymarkdown",function(){return function(a,b,c){a.$watch("challenge",function(a){$("pre code").each(function(a,b){hljs.highlightBlock(b)})})}}),angular.module("myApp.challenge").factory("ChallengeServices",["$http","$q","$timeout","$cacheFactory","SettingServices","ContainerServices",function(a,b,c,d,e,f){var g={};return g.getChallenge=function(b){return a.get(e.getSrvApiUrl()+"/challenge/"+b).success(function(a){var b=new showdown.Converter;return a.inputHtml=b.makeHtml(a.Text),a})},g.getChallenges=function(){return a.get(e.getSrvApiUrl()+"/challenges")},g}]),angular.module("myApp.container",["ngRoute"]).config(["$routeProvider",function(a){a.when("/container/:containerName",{title:"Container",templateUrl:"modules/container/container.html",controller:"containerPageCtrl"}).when("/container",{title:"Container",templateUrl:"modules/container/container-list.html",controller:"containerListCtrl",resolve:{baseContainers:["ContainerServices",function(a){return a.getBaseContainerList()}],containers:["ContainerServices",function(a){return a.getContainerList()}]}}).when("/container/:containerHostAlias/:containerBaseName/console",{title:"Container Console",templateUrl:"modules/container/container-console.html",controller:"containerConsoleCtrl"})}]).controller("containerConsoleCtrl",["$scope","$routeParams","$filter","$location","$route","ContainerServices",function(a,b,c,d,e,f){"ngInject";var g=e.current.params.containerHostAlias,h=e.current.params.containerBaseName;f.getHostnameForAlias(g).then(function(a){a.Hostname});var i={height:25,width:80,id:null,term:null};a.terminal=i,a.showAddTerminalButton=!1,f.startContainerIfNecessary(g,h).then(function(b){a.terminal.term=f.getTerminal(i.height),a.terminal.term.open(document.getElementById("console"));var c=a.terminal.term.proposeGeometry(),d=c.cols,e=c.rows;a.terminal.width=80,f.getWebsocketTerminal(a.terminal.term,g,h,d,e),a.terminal.term.on("destroy",function(){console.log("DDDDDDDDDDDD")}),a.terminal.term.on("resize",function(a){a.cols,a.rows})}).finally(function(){})}]).controller("containerPageCtrl",["$scope","$routeParams","$filter","$location","ContainerServices",function(a,b,c,d,e){"ngInject"}]).controller("containerListCtrl",["$scope","$routeParams","$filter","$location","$window","ContainerServices","baseContainers","containers",function(a,b,c,d,e,f,g,h){"ngInject";a.baseContainers=g.data,a.containers=h,a.startContainer=function(b){f.startContainerIfNecessary(b.ContainerHost.HostnameAlias,b.ContainerBaseName).then(function(c){for(var d=0;d<a.containers.length;d++)a.containers[d]==b&&(a.containers[d].ContainerUsername=c.data.username,a.containers[d].ContainerPassword=c.data.password,a.containers[d].ContainerExpiry=c.data.expiry,a.containers[d].ContainerStatus=c.data.status)})},a.startConsole=function(a){var b=d.protocol()+"://"+d.host()+":"+d.port();b+="#/container/"+a.ContainerHost.HostnameAlias+"/"+a.BaseContainer.Name+"/console",e.open(b,"_blank")}}]),angular.module("myApp.container").factory("ContainerServices",["$http","$q","$timeout","$cacheFactory","SettingServices","AuthenticationServices",function(a,b,c,d,e,f){var g={};d("containerServiceCache");return g.getBaseContainerList=function(){var b=e.getSrvApiUrl()+"/baseContainers";return a.get(b)},g.getContainerHostList=function(){var b=e.getSrvApiUrl()+"/containerHosts";return a.get(b)},g.getContainerList=function(){return g.getContainerHostList().then(function(c){var d=c.data;return g.getBaseContainerList().then(function(c){var e=c.data,f=d.map(function(b){var c="//"+b.Hostname+"/1.0/container";return a.get(c).then(function(a){if(a.data)for(var c=0;c<a.data.length;c++)a.data[c].ContainerHost=b,a.data[c].BaseContainer=_.findWhere(e,{Name:a.data[c].ContainerBaseName}),a.data[c].ContainerHostAlias=a.data[c].ContainerHost.HostnameAlias;return a.data},function(a){console.log("BLA")})});return b.all(f).then(function(a){for(var b=[],c=0;c<a.length;c++)if(null!=a[c])for(var f=0;f<a[c].length;f++)b.push(a[c][f]);for(var g=0;g<d.length;g++)for(var c=0;c<e.length;c++)_.findWhere(b,{ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name})||b.push({ContainerHostAlias:d[g].HostnameAlias,ContainerBaseName:e[c].Name,ContainerHost:d[g],BaseContainer:e[c]});return b},function(a){console.log("BLaA")})})})},g.adminCmd=function(c){return g.getContainerHostList().then(function(d){var e=d.data,f=e.map(function(b){var d="//"+b.Hostname+"/1.0/admin/exec/"+c;return a.get(d)});return b.all(f)})},g.getHostnameForAlias=function(b){var c=e.getSrvApiUrl()+"/containerHosts";return a.get(c).then(function(a){var c=a.data,d=_.findWhere(c,{HostnameAlias:b});return d})},g.startContainerIfNecessary=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d=b,e="//"+d.Hostname+"/1.0/container/"+c+"/start";return a.get(e)})},g.stopContainer=function(b,c){return g.getHostnameForAlias(b).then(function(b){var d="//"+b.Hostname+"/1.0/container/"+c+"/stop";return a.get(d)})},g.getContainerInfo=function(b,c){return g.getHostnameForAlias(c).then(function(c){var d="//"+c.Hostname+"/1.0/container/"+b;return a.get(d)})},g.getTerminal=function(a){var b=new Terminal({cols:80,rows:a,useStyle:!0,screenKeys:!1,cursorBlink:!1});return b},g.getWebsocketTerminal=function(a,b,c,d,e){return g.getHostnameForAlias(b).then(function(b){var g,h=b;g="https:"===location.protocol?"wss://":"ws://";var i=g+h.Hostname+"/1.0/container/"+c+"/console?width="+d+"&height="+e+"&token="+f.getToken(),j=new WebSocket(i);a.on("data",function(a){j.send(btoa(a))}),j.onopen=function(b){j.onmessage=function(b){var c=atob(b.data);a.write(c)},j.onclose=function(b){console.log("WebSocket closed"),a.destroy()},j.onerror=function(a){console.error(a)}}})},g}]),angular.module("myApp.setting",["ngRoute"]).config(["$routeProvider",function(a){a.when("/settings",{title:"Settings",templateUrl:"modules/setting/settings.html",controller:"settingListCtrl",resolve:{myconfig:["SettingServices","$route",function(a,b){return a.getMyCfg()}]}})}]).controller("settingListCtrl",["$http","$scope","$routeParams","$route","$filter","$location","$uibModal","$window","SettingServices","myconfig",function(a,b,c,d,e,f,g,h,i,j){b.myconfig=j,b.test={},b.testUrl=i.getLxdApiUrl(),i.getConfig().then(function(a){b.config=a.data.metadata},function(a){b.errMsg="Could not get config from server: "+i.getLxdUrl()}),b.save=function(){i.setMyCfg(b.myconfig),d.reload()}}]),angular.module("myApp.setting").factory("SettingServices",["$http","$q","$timeout",function(a,b,c){var d={};return d.getMyCfg=function(){var a;a="localhost"===location.hostname||"127.0.0.1"===location.hostname?"localhost:8090":"exploit.courses";var b={srvurl:a};return b},d.setMyCfg=function(a){localStorage.setItem("lxdcfg",JSON.stringify(a))},d.getSrvUrl=function(){return"//"+d.getMyCfg().srvurl},d.getSrvApiUrl=function(){return"//"+d.getMyCfg().srvurl+"/1.0"},d}]),angular.module("myApp.staticpages",["ngRoute"]).config(["$routeProvider",function(a){a.when("/staticpages/index",{title:"Staticpages",templateUrl:"modules/staticpages/index.html",controller:"staticpagesIndexCtrl"})}]).controller("staticpagesIndexCtrl",["$scope","$window","$routeParams","$filter","$location",function(a,b,c,d,e){"ngInject"}]);