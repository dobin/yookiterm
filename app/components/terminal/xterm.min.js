!function(a){"object"==typeof exports&&"object"==typeof module?module.exports=a.call(this):"function"==typeof define?define([],a.bind(window)):(this.Xterm=a.call(this),this.Terminal=this.Xterm)}(function(){"use strict";function a(){this._events=this._events||{}}function b(a,b,c){this.textarea=a,this.compositionView=b,this.terminal=c,this.isComposing=!1,this.compositionText=null,this.compositionPosition={start:null,end:null},this.isSendingComposition=!1}function c(a,b,c,d){this.terminal=a,this.viewportElement=b,this.scrollArea=c,this.charMeasureElement=d,this.currentRowHeight=0,this.lastRecordedBufferLength=0,this.lastRecordedViewportHeight=0,this.terminal.on("scroll",this.syncScrollArea.bind(this)),this.terminal.on("resize",this.syncScrollArea.bind(this)),this.viewportElement.addEventListener("scroll",this.onScroll.bind(this)),this.syncScrollArea()}function d(b){var c=this;if(!(this instanceof d))return new d(arguments[0],arguments[1],arguments[2]);c.cancel=d.cancel,a.call(this),"number"==typeof b&&(b={cols:arguments[0],rows:arguments[1],handler:arguments[2]}),b=b||{},Object.keys(d.defaults).forEach(function(a){null==b[a]&&(b[a]=d.options[a],d[a]!==d.defaults[a]&&(b[a]=d[a])),c[a]=b[a]}),8===b.colors.length?b.colors=b.colors.concat(d._colors.slice(8)):16===b.colors.length?b.colors=b.colors.concat(d._colors.slice(16)):10===b.colors.length?b.colors=b.colors.slice(0,-2).concat(d._colors.slice(8,-2),b.colors.slice(-2)):18===b.colors.length&&(b.colors=b.colors.concat(d._colors.slice(16,-2),b.colors.slice(-2))),this.colors=b.colors,this.options=b,this.parent=b.body||b.parent||(o?o.getElementsByTagName("body")[0]:null),this.cols=b.cols||b.geometry[0],this.rows=b.rows||b.geometry[1],b.handler&&this.on("data",b.handler),this.ybase=0,this.ydisp=0,this.x=0,this.y=0,this.isRefreshing=!1,this.cursorState=0,this.cursorHidden=!1,this.convertEol,this.state=0,this.queue="",this.scrollTop=0,this.scrollBottom=this.rows-1,this.customKeydownHandler=null,this.applicationKeypad=!1,this.applicationCursor=!1,this.originMode=!1,this.insertMode=!1,this.wraparoundMode=!0,this.normal=null,this.charset=null,this.gcharset=null,this.glevel=0,this.charsets=[null],this.decLocator,this.x10Mouse,this.vt200Mouse,this.vt300Mouse,this.normalMouse,this.mouseEvents,this.sendFocus,this.utfMouse,this.sgrMouse,this.urxvtMouse,this.element,this.children,this.refreshStart,this.refreshEnd,this.savedX,this.savedY,this.savedCols,this.readable=!0,this.writable=!0,this.defAttr=131840,this.curAttr=this.defAttr,this.params=[],this.currentParam=0,this.prefix="",this.postfix="",this.surrogate_high="",this.lines=[];for(var e=this.rows;e--;)this.lines.push(this.blankLine());this.tabs,this.setupStops()}function e(a,b){for(var c=0;c<b.length;c+=1)if(a===b[c])return!0;return!1}function f(a,b,c,d){Array.isArray(a)||(a=[a]),a.forEach(function(a){a.addEventListener(b,c,d||!1)})}function g(a,b,c,d){a.removeEventListener(b,c,d||!1)}function h(a,b){if(this.cancelEvents||b)return a.preventDefault(),a.stopPropagation(),!1}function i(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function j(a){var b=a.getElementsByTagName("body")[0],c=a.createElement("span");c.innerHTML="hello world",b.appendChild(c);var d=c.scrollWidth;c.style.fontWeight="bold";var e=c.scrollWidth;return b.removeChild(c),d!==e}function k(a,b){var c=a.isMac&&b.altKey&&!b.ctrlKey&&!b.metaKey||a.isMSWindows&&b.altKey&&b.ctrlKey&&!b.metaKey;return"keypress"==b.type?c:c&&(!b.keyCode||b.keyCode>47)}function l(a,b,c){var e=a<<16|b<<8|c;if(null!=l._cache[e])return l._cache[e];for(var f,g,h,i,j,k=1/0,m=-1,n=0;n<d.vcolors.length;n++){if(f=d.vcolors[n],g=f[0],h=f[1],i=f[2],j=l.distance(a,b,c,g,h,i),0===j){m=n;break}j<k&&(k=j,m=n)}return l._cache[e]=m}function m(a,b,c){if(a.forEach)return a.forEach(b,c);for(var d=0;d<a.length;d++)b.call(c,a[d],d,a)}function n(a){if(Object.keys)return Object.keys(a);var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}var o=this.document;a.prototype.addListener=function(a,b){this._events[a]=this._events[a]||[],this._events[a].push(b)},a.prototype.on=a.prototype.addListener,a.prototype.removeListener=function(a,b){if(this._events[a])for(var c=this._events[a],d=c.length;d--;)if(c[d]===b||c[d].listener===b)return void c.splice(d,1)},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(a){this._events[a]&&delete this._events[a]},a.prototype.once=function(a,b){function c(){var d=Array.prototype.slice.call(arguments);return this.removeListener(a,c),b.apply(this,d)}return c.listener=b,this.on(a,c)},a.prototype.emit=function(a){if(this._events[a])for(var b=Array.prototype.slice.call(arguments,1),c=this._events[a],d=c.length,e=0;e<d;e++)c[e].apply(this,b)},a.prototype.listeners=function(a){return this._events[a]=this._events[a]||[]},b.prototype.compositionstart=function(){this.isComposing=!0,this.compositionPosition.start=this.textarea.value.length,this.compositionView.textContent="",this.compositionView.classList.add("active")},b.prototype.compositionupdate=function(a){this.compositionView.textContent=a.data,this.updateCompositionElements();var b=this;x(function(){b.compositionPosition.end=b.textarea.value.length},0)},b.prototype.compositionend=function(){this.finalizeComposition(!0)},b.prototype.keydown=function(a){if(this.isComposing||this.isSendingComposition){if(229===a.keyCode)return!1;if(16===a.keyCode||17===a.keyCode||18===a.keyCode)return!1;this.finalizeComposition(!1)}return 229!==a.keyCode||(this.handleAnyTextareaChanges(),!1)},b.prototype.finalizeComposition=function(a){if(this.compositionView.classList.remove("active"),this.isComposing=!1,this.clearTextareaPosition(),a){var b={start:this.compositionPosition.start,end:this.compositionPosition.end},c=this;this.isSendingComposition=!0,x(function(){if(c.isSendingComposition){c.isSendingComposition=!1;var a;a=c.isComposing?c.textarea.value.substring(b.start,b.end):c.textarea.value.substring(b.start),c.terminal.handler(a)}},0)}else{this.isSendingComposition=!1;var d=this.textarea.value.substring(this.compositionPosition.start,this.compositionPosition.end);this.terminal.handler(d)}},b.prototype.handleAnyTextareaChanges=function(){var a=this.textarea.value,b=this;x(function(){if(!b.isComposing){var c=b.textarea.value,d=c.replace(a,"");d.length>0&&b.terminal.handler(d)}},0)},b.prototype.updateCompositionElements=function(a){if(this.isComposing){var b=this.terminal.element.querySelector(".terminal-cursor");if(b){this.compositionView.style.left=b.offsetLeft+"px",this.compositionView.style.top=b.offsetTop+"px";var c=this.compositionView.getBoundingClientRect();this.textarea.style.left=b.offsetLeft+c.width+"px",this.textarea.style.top=b.offsetTop+b.offsetHeight+"px"}a||x(this.updateCompositionElements.bind(this,!0),0)}},b.prototype.clearTextareaPosition=function(){this.textarea.style.left="",this.textarea.style.top=""},c.prototype.refresh=function(a){var b=a||this.charMeasureElement.getBoundingClientRect();if(b.height>0){var c=b.height!==this.currentRowHeight;c&&(this.currentRowHeight=b.height,this.viewportElement.style.lineHeight=b.height+"px",this.terminal.rowContainer.style.lineHeight=b.height+"px");var d=this.lastRecordedViewportHeight!==this.terminal.rows;(c||d)&&(this.lastRecordedViewportHeight=this.terminal.rows,this.viewportElement.style.height=b.height*this.terminal.rows+"px"),this.scrollArea.style.height=b.height*this.lastRecordedBufferLength+"px"}},c.prototype.syncScrollArea=function(){if(this.isApplicationMode)return this.lastRecordedBufferLength=this.terminal.rows,void this.refresh();if(this.lastRecordedBufferLength!==this.terminal.lines.length)this.lastRecordedBufferLength=this.terminal.lines.length,this.refresh();else if(this.lastRecordedViewportHeight!==this.terminal.rows)this.refresh();else{var a=this.charMeasureElement.getBoundingClientRect();a.height!==this.currentRowHeight&&this.refresh(a)}var b=this.terminal.ydisp*this.currentRowHeight;this.viewportElement.scrollTop!==b&&(this.viewportElement.scrollTop=b)},c.prototype.setApplicationMode=function(a){this.isApplicationMode=a,this.syncScrollArea()},c.prototype.onScroll=function(a){if(!this.isApplicationMode){var b=Math.round(this.viewportElement.scrollTop/this.currentRowHeight),c=b-this.terminal.ydisp;this.terminal.scrollDisp(c,!0)}},c.prototype.onWheel=function(a){if(0!==a.deltaY){var b=1;a.deltaMode===WheelEvent.DOM_DELTA_LINE?b=this.currentRowHeight:a.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(b=this.currentRowHeight*this.terminal.rows),this.viewportElement.scrollTop+=a.deltaY*b,a.preventDefault()}};var p=0,q=1,r=2,s=3,t=4,u=5,v=6;i(d,a),d.prototype.eraseAttr=function(){return this.defAttr&-512|511&this.curAttr},d.tangoColors=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"],d.colors=function(){function a(a,c,d){e.push("#"+b(a)+b(c)+b(d))}function b(a){return a=a.toString(16),a.length<2?"0"+a:a}var c,e=d.tangoColors.slice(),f=[0,95,135,175,215,255];for(c=0;c<216;c++)a(f[c/36%6|0],f[c/6%6|0],f[c%6]);for(c=0;c<24;c++)f=8+10*c,a(f,f,f);return e}(),d._colors=d.colors.slice(),d.vcolors=function(){for(var a,b=[],c=d.colors,e=0;e<256;e++)a=parseInt(c[e].substring(1),16),b.push([a>>16&255,a>>8&255,255&a]);return b}(),d.defaults={colors:d.colors,theme:"default",convertEol:!1,termName:"xterm",geometry:[80,24],cursorBlink:!1,visualBell:!1,popOnBell:!1,scrollback:1e3,screenKeys:!1,debug:!1,cancelEvents:!1},d.options={},d.focus=null,m(n(d.defaults),function(a){d[a]=d.defaults[a],d.options[a]=d.defaults[a]}),d.prototype.focus=function(){return this.textarea.focus()},d.bindFocus=function(a){f(a.textarea,"focus",function(b){a.sendFocus&&a.send("[I"),a.element.classList.add("focus"),a.showCursor(),d.focus=a,a.emit("focus",{terminal:a})})},d.prototype.blur=function(){return this.textarea.blur()},d.bindBlur=function(a){f(a.textarea,"blur",function(b){a.refresh(a.y,a.y),a.sendFocus&&a.send("[O"),a.element.classList.remove("focus"),d.focus=null,a.emit("blur",{terminal:a})})},d.prototype.initGlobal=function(){d.bindPaste(this),d.bindKeys(this),d.bindCopy(this),d.bindFocus(this),d.bindBlur(this)},d.bindPaste=function(a){f([a.textarea,a.element],"paste",function(b){if(b.stopPropagation(),b.clipboardData){var c=b.clipboardData.getData("text/plain");return a.handler(c),a.textarea.value="",a.cancel(b)}})},d.prepareCopiedTextForClipboard=function(a){var b=w.fromCharCode(32),c=w.fromCharCode(160),d=new RegExp(c,"g"),e=a.split("\n").map(function(a){var c=a.replace(/\s+$/g,"").replace(d,b);return c}).join("\n");return e},d.bindKeys=function(a){f(a.element,"keydown",function(b){o.activeElement==this&&a.keyDown(b)},!0),f(a.element,"keypress",function(b){o.activeElement==this&&a.keyPress(b)},!0),f(a.element,"keyup",a.focus.bind(a)),f(a.textarea,"keydown",function(b){a.keyDown(b)},!0),f(a.textarea,"keypress",function(b){a.keyPress(b),this.value=""},!0),f(a.textarea,"compositionstart",a.compositionHelper.compositionstart.bind(a.compositionHelper)),f(a.textarea,"compositionupdate",a.compositionHelper.compositionupdate.bind(a.compositionHelper)),f(a.textarea,"compositionend",a.compositionHelper.compositionend.bind(a.compositionHelper)),a.on("refresh",a.compositionHelper.updateCompositionElements.bind(a.compositionHelper))},d.bindCopy=function(a){f(a.element,"copy",function(a){})},d.prototype.insertRow=function(a){return"object"!=typeof a&&(a=o.createElement("div")),this.rowContainer.appendChild(a),this.children.push(a),a},d.prototype.open=function(a){var g=this,h=0;if(this.parent=a||this.parent,!this.parent)throw new Error("Terminal requires a parent element.");for(this.context=this.parent.ownerDocument.defaultView,this.document=this.parent.ownerDocument,this.body=this.document.getElementsByTagName("body")[0],this.context.navigator&&this.context.navigator.userAgent&&(this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE")),this.context.navigator&&this.context.navigator.platform&&(this.isMac=e(this.context.navigator.platform,["Macintosh","MacIntel","MacPPC","Mac68K"]),this.isIpad="iPad"===this.context.navigator.platform,this.isIphone="iPhone"===this.context.navigator.platform,this.isMSWindows=e(this.context.navigator.platform,["Windows","Win16","Win32","WinCE"])),this.element=this.document.createElement("div"),this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.classList.add("xterm-theme-"+this.theme),this.element.style.height,this.element.setAttribute("tabindex",0),this.viewportElement=o.createElement("div"),this.viewportElement.classList.add("xterm-viewport"),this.element.appendChild(this.viewportElement),this.viewportScrollArea=o.createElement("div"),this.viewportScrollArea.classList.add("xterm-scroll-area"),this.viewportElement.appendChild(this.viewportScrollArea),this.rowContainer=o.createElement("div"),this.rowContainer.classList.add("xterm-rows"),this.element.appendChild(this.rowContainer),this.children=[],this.helperContainer=o.createElement("div"),this.helperContainer.classList.add("xterm-helpers"),this.element.appendChild(this.helperContainer),this.textarea=o.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this.textarea.addEventListener("focus",function(){g.emit("focus",{terminal:g})}),this.textarea.addEventListener("blur",function(){g.emit("blur",{terminal:g})}),this.helperContainer.appendChild(this.textarea),this.compositionView=o.createElement("div"),this.compositionView.classList.add("composition-view"),this.compositionHelper=new b(this.textarea,this.compositionView,this),this.helperContainer.appendChild(this.compositionView),this.charMeasureElement=o.createElement("div"),this.charMeasureElement.classList.add("xterm-char-measure-element"),this.charMeasureElement.innerHTML="W",this.helperContainer.appendChild(this.charMeasureElement);h<this.rows;h++)this.insertRow();this.parent.appendChild(this.element),this.viewport=new c(this,this.viewportElement,this.viewportScrollArea,this.charMeasureElement),this.refresh(0,this.rows-1),this.initGlobal(),this.focus(),f(this.element,"mouseup",function(){var a=o.getSelection(),b=a.isCollapsed,c="boolean"==typeof b?!b:"Range"==a.type;c||g.focus()}),this.bindMouse(),null==d.brokenBold&&(d.brokenBold=j(this.document)),this.emit("open")},d.loadAddon=function(a,b){return"object"==typeof exports&&"object"==typeof module?require(__dirname+"/../addons/"+a):"function"==typeof define?require(["../addons/"+a+"/"+a],b):(console.error("Cannot load a module without a CommonJS or RequireJS environment."),!1)},d.prototype.bindMouse=function(){function a(a){var b,c;if(b=e(a),c=h(a))switch(d(b,c),a.overrideType||a.type){case"mousedown":k=b;break;case"mouseup":k=32;break;case"wheel":}}function b(a){var b,c=k;b=h(a),b&&(c+=32,d(c,b))}function c(a,b){if(j.utfMouse){if(2047===b)return a.push(0);b<127?a.push(b):(b>2047&&(b=2047),a.push(192|b>>6),a.push(128|63&b))}else{if(255===b)return a.push(0);b>127&&(b=127),a.push(b)}}function d(a,b){if(j.vt300Mouse){a&=3,b.x-=32,b.y-=32;var d="[24";if(0===a)d+="1";else if(1===a)d+="3";else if(2===a)d+="5";else{if(3===a)return;d+="0"}return d+="~["+b.x+","+b.y+"]\r",void j.send(d)}if(j.decLocator)return a&=3,b.x-=32,b.y-=32,0===a?a=2:1===a?a=4:2===a?a=6:3===a&&(a=3),void j.send("["+a+";"+(3===a?4:0)+";"+b.y+";"+b.x+";"+(b.page||0)+"&w");if(j.urxvtMouse)return b.x-=32,b.y-=32,b.x++,b.y++,void j.send("["+a+";"+b.x+";"+b.y+"M");if(j.sgrMouse)return b.x-=32,b.y-=32,void j.send("[<"+(3===(3&a)?a&-4:a)+";"+b.x+";"+b.y+(3===(3&a)?"m":"M"));var d=[];c(d,a),c(d,b.x),c(d,b.y),j.send("[M"+w.fromCharCode.apply(w,d))}function e(a){var b,c,d,e,f;switch(a.overrideType||a.type){case"mousedown":b=null!=a.button?+a.button:null!=a.which?a.which-1:null,j.isMSIE&&(b=1===b?0:4===b?1:b);break;case"mouseup":b=3;break;case"DOMMouseScroll":b=a.detail<0?64:65;break;case"wheel":b=a.wheelDeltaY>0?64:65}return c=a.shiftKey?4:0,d=a.metaKey?8:0,e=a.ctrlKey?16:0,f=c|d|e,j.vt200Mouse?f&=e:j.normalMouse||(f=0),b=32+(f<<2)+b}function h(a){var b,c,d,e,f;if(null!=a.pageX){for(b=a.pageX,c=a.pageY,f=j.element;f&&f!==j.document.documentElement;)b-=f.offsetLeft,c-=f.offsetTop,f="offsetParent"in f?f.offsetParent:f.parentNode;return d=j.element.clientWidth,e=j.element.clientHeight,b=Math.ceil(b/d*j.cols),c=Math.ceil(c/e*j.rows),b<0&&(b=0),b>j.cols&&(b=j.cols),c<0&&(c=0),c>j.rows&&(c=j.rows),b+=32,c+=32,{x:b,y:c,type:"wheel"}}}var i=this.element,j=this,k=32;f(i,"mousedown",function(c){if(j.mouseEvents)return a(c),j.focus(),j.vt200Mouse?(c.overrideType="mouseup",a(c),j.cancel(c)):(j.normalMouse&&f(j.document,"mousemove",b),j.x10Mouse||f(j.document,"mouseup",function c(d){return a(d),j.normalMouse&&g(j.document,"mousemove",b),g(j.document,"mouseup",c),j.cancel(d)}),j.cancel(c))}),f(i,"wheel",function(b){if(j.mouseEvents&&!(j.x10Mouse||j.vt300Mouse||j.decLocator))return a(b),j.cancel(b)}),f(i,"wheel",function(a){if(!j.mouseEvents&&!j.applicationKeypad)return j.viewport.onWheel(a),j.cancel(a)})},d.prototype.destroy=function(){this.readable=!1,this.writable=!1,this._events={},this.handler=function(){},this.write=function(){},this.element.parentNode&&this.element.parentNode.removeChild(this.element)},d.flags={BOLD:1,UNDERLINE:2,BLINK:4,INVERSE:8,INVISIBLE:16},d.prototype.refresh=function(a,b,c){var e=this;if(c="undefined"==typeof c||c)return void(this._refreshIsQueued?this._fullRefreshNext=!0:(x(function(){e.refresh(a,b,!1)},34),this._refreshIsQueued=!0));this._refreshIsQueued=!1,this._fullRefreshNext&&(a=0,b=this.rows-1,this._fullRefreshNext=!1);var f,g,h,i,j,k,l,m,n,p,q,r,s,t,u;o.activeElement;for(b-a>=this.rows/2&&(u=this.element.parentNode,u&&this.element.removeChild(this.rowContainer)),m=this.cols,g=a,b>=this.rows.length&&(this.log("`end` is too large. Most likely a bad CSR."),b=this.rows.length-1);g<=b;g++){for(t=g+this.ydisp,i=this.lines[t],j="",f=this.y===g-(this.ybase-this.ydisp)&&this.cursorState&&!this.cursorHidden?this.x:-1,p=this.defAttr,h=0;h<m;h++)if(n=i[h][0],k=i[h][1],l=i[h][2]){if(h===f&&(n=-1),n!==p&&(p!==this.defAttr&&(j+="</span>"),n!==this.defAttr))if(n===-1)j+='<span class="reverse-video terminal-cursor',this.cursorBlink&&(j+=" blinking"),j+='">';else{var v=[];q=511&n,r=n>>9&511,s=n>>18,s&d.flags.BOLD&&(d.brokenBold||v.push("xterm-bold"),r<8&&(r+=8)),s&d.flags.UNDERLINE&&v.push("xterm-underline"),s&d.flags.BLINK&&v.push("xterm-blink"),s&d.flags.INVERSE&&(q=[r,r=q][0],1&s&&r<8&&(r+=8)),s&d.flags.INVISIBLE&&v.push("xterm-hidden"),s&d.flags.INVERSE&&(257==q&&(q=15),256==r&&(r=0)),q<256&&v.push("xterm-bg-color-"+q),r<256&&v.push("xterm-color-"+r),j+="<span",v.length&&(j+=' class="'+v.join(" ")+'"'),j+=">"}switch(k){case"&":j+="&amp;";break;case"<":j+="&lt;";break;case">":j+="&gt;";break;default:j+=k<=" "?"&nbsp;":k}p=n}p!==this.defAttr&&(j+="</span>"),this.children[g].innerHTML=j}u&&this.element.appendChild(this.rowContainer),this.emit("refresh",{element:this.element,start:a,end:b})},d.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.y,this.y))},d.prototype.scroll=function(){var a;++this.ybase===this.scrollback&&(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+this.rows)+1)),this.ydisp=this.ybase,a=this.ybase+this.rows-1,a-=this.rows-1-this.scrollBottom,a===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(a,0,this.blankLine()),0!==this.scrollTop&&(0!==this.ybase&&(this.ybase--,this.ydisp=this.ybase),this.lines.splice(this.ybase+this.scrollTop,1)),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom),this.emit("scroll",this.ydisp)},d.prototype.scrollDisp=function(a,b){this.ydisp+=a,this.ydisp>this.ybase?this.ydisp=this.ybase:this.ydisp<0&&(this.ydisp=0),b||this.emit("scroll",this.ydisp),this.refresh(0,this.rows-1)},d.prototype.write=function(a){var b,c,e,f,g,h,i=a.length,j=0;for(this.refreshStart=this.y,this.refreshEnd=this.y,this.ybase!==this.ydisp&&(this.ydisp=this.ybase,this.emit("scroll",this.ydisp),this.maxRange()),this.surrogate_high&&(a=this.surrogate_high+a,this.surrogate_high="");j<i;j++){if(c=a[j],e=a.charCodeAt(j),55296<=e&&e<=56319){if(f=a.charCodeAt(j+1),isNaN(f)){this.surrogate_high=c;continue}e=1024*(e-55296)+(f-56320)+65536,c+=a.charAt(j+1)}if(!(56320<=e&&e<=57343))switch(this.state){case p:switch(c){case"":this.bell();break;case"\n":case"\v":case"\f":this.convertEol&&(this.x=0),this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll());break;case"\r":this.x=0;break;case"\b":this.x>0&&this.x--;break;case"\t":this.x=this.nextStop();break;case"":this.setgLevel(1);break;case"":this.setgLevel(0);break;case"":this.state=q;break;default:if(g=y(e),c>=" "){if(this.charset&&this.charset[c]&&(c=this.charset[c]),h=this.y+this.ybase,!g&&this.x){this.lines[h][this.x-1]&&(this.lines[h][this.x-1][2]?this.lines[h][this.x-1][1]+=c:this.lines[h][this.x-2]&&(this.lines[h][this.x-2][1]+=c),this.updateRange(this.y));break}if(this.x+g-1>=this.cols)if(this.wraparoundMode)this.x=0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll());else if(this.x=this.cols-1,2===g)continue;if(h=this.y+this.ybase,this.insertMode)for(var k=0;k<g;++k){var l=this.lines[this.y+this.ybase].pop();0===l[2]&&this.lines[h][this.cols-2]&&2===this.lines[h][this.cols-2][2]&&(this.lines[h][this.cols-2]=[this.curAttr," ",1]),this.lines[h].splice(this.x,0,[this.curAttr," ",1])}this.lines[h][this.x]=[this.curAttr,c,g],this.x++,this.updateRange(this.y),2===g&&(this.lines[h][this.x]=[this.curAttr,"",0],this.x++)}}break;case q:switch(c){case"[":this.params=[],this.currentParam=0,this.state=r;break;case"]":this.params=[],this.currentParam=0,this.state=s;break;case"P":this.params=[],this.currentParam=0,this.state=u;break;case"_":this.state=v;break;case"^":this.state=v;break;case"c":this.reset();break;case"E":this.x=0;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.setgLevel(0),this.setgCharset(0,d.charsets.US),this.state=p,j++;break;case"(":case")":case"*":case"+":case"-":case".":switch(c){case"(":this.gcharset=0;break;case")":this.gcharset=1;break;case"*":this.gcharset=2;break;case"+":this.gcharset=3;break;case"-":this.gcharset=1;break;case".":this.gcharset=2}this.state=t;break;case"/":this.gcharset=3,this.state=t,j--;break;case"N":break;case"O":break;case"n":this.setgLevel(2);break;case"o":this.setgLevel(3);break;case"|":this.setgLevel(3);break;case"}":this.setgLevel(2);break;case"~":this.setgLevel(1);break;case"7":this.saveCursor(),this.state=p;break;case"8":this.restoreCursor(),this.state=p;break;case"#":this.state=p,j++;break;case"H":this.tabSet();break;case"=":this.log("Serial port requested application keypad."),this.applicationKeypad=!0,this.viewport.setApplicationMode(!0),this.state=p;break;case">":this.log("Switching back to normal keypad."),this.applicationKeypad=!1,this.viewport.setApplicationMode(!1),this.state=p;break;default:this.state=p,this.error("Unknown ESC control: %s.",c)}break;case t:switch(c){case"0":b=d.charsets.SCLD;break;case"A":b=d.charsets.UK;break;case"B":b=d.charsets.US;break;case"4":b=d.charsets.Dutch;break;case"C":case"5":b=d.charsets.Finnish;break;case"R":b=d.charsets.French;break;case"Q":b=d.charsets.FrenchCanadian;break;case"K":b=d.charsets.German;break;case"Y":b=d.charsets.Italian;break;case"E":case"6":b=d.charsets.NorwegianDanish;break;case"Z":b=d.charsets.Spanish;break;case"H":case"7":b=d.charsets.Swedish;break;case"=":b=d.charsets.Swiss;break;case"/":b=d.charsets.ISOLatin,j++;break;default:b=d.charsets.US}this.setgCharset(this.gcharset,b),this.gcharset=null,this.state=p;break;case s:if(""===c||""===c){switch(""===c&&j++,this.params.push(this.currentParam),this.params[0]){case 0:case 1:case 2:this.params[1]&&(this.title=this.params[1],this.handleTitle(this.title));break;case 3:break;case 4:case 5:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break;case 46:break;case 50:break;case 51:break;case 52:break;case 104:case 105:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:}this.params=[],this.currentParam=0,this.state=p}else this.params.length?this.currentParam+=c:c>="0"&&c<="9"?this.currentParam=10*this.currentParam+c.charCodeAt(0)-48:";"===c&&(this.params.push(this.currentParam),this.currentParam="");break;case r:if("?"===c||">"===c||"!"===c){this.prefix=c;break}if(c>="0"&&c<="9"){this.currentParam=10*this.currentParam+c.charCodeAt(0)-48;break}if("$"===c||'"'===c||" "===c||"'"===c){this.postfix=c;break}if(this.params.push(this.currentParam),this.currentParam=0,";"===c)break;switch(this.state=p,c){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":this.prefix||this.charAttributes(this.params);break;case"n":this.prefix||this.deviceStatus(this.params);break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":this.params.length<2&&!this.prefix&&this.scrollDown(this.params);break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":switch(this.prefix){case"!":this.softReset(this.params)}break;default:this.error("Unknown CSI code: %s.",c)}this.prefix="",this.postfix="";break;case u:if(""===c||""===c){switch(""===c&&j++,this.prefix){case"":break;case"$q":var m=this.currentParam,n=!1;switch(m){case'"q':m='0"q';break;case'"p':m='61"p';break;case"r":m=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";break;case"m":m="0m";break;default:this.error("Unknown DCS Pt: %s.",m),m=""}this.send("P"+ +n+"$r"+m+"\\");break;case"+p":break;case"+q":var m=this.currentParam,n=!1;this.send("P"+ +n+"+r"+m+"\\");break;default:this.error("Unknown DCS prefix: %s.",this.prefix)}this.currentParam=0,this.prefix="",this.state=p}else this.currentParam?this.currentParam+=c:this.prefix||"$"===c||"+"===c?2===this.prefix.length?this.currentParam=c:this.prefix+=c:this.currentParam=c;break;case v:""!==c&&""!==c||(""===c&&j++,this.state=p)}}this.updateRange(this.y),this.refresh(this.refreshStart,this.refreshEnd)},d.prototype.writeln=function(a){this.write(a+"\r\n")},d.prototype.attachCustomKeydownHandler=function(a){this.customKeydownHandler=a},d.prototype.keyDown=function(a){if(this.customKeydownHandler&&this.customKeydownHandler(a)===!1)return!1;if(!this.compositionHelper.keydown.bind(this.compositionHelper)(a))return!1;var b=this.evaluateKeyEscapeSequence(a);return b.scrollDisp?(this.scrollDisp(b.scrollDisp),this.cancel(a)):!!k(this,a)||(b.cancel&&this.cancel(a,!0),!b.key||(this.emit("keydown",a),this.emit("key",b.key,a),this.showCursor(),this.handler(b.key),this.cancel(a,!0)))},d.prototype.evaluateKeyEscapeSequence=function(a){var b={cancel:!1,key:void 0,scrollDisp:void 0},c=a.shiftKey<<0|a.altKey<<1|a.ctrlKey<<2|a.metaKey<<3;switch(a.keyCode){case 8:if(a.shiftKey){b.key="\b";break}b.key="";break;case 9:if(a.shiftKey){b.key="[Z";break}b.key="\t",b.cancel=!0;break;case 13:b.key="\r",b.cancel=!0;break;case 27:b.key="",b.cancel=!0;break;case 37:c?(b.key="[1;"+(c+1)+"D","[1;3D"==b.key&&(b.key="[1;5D")):this.applicationCursor?b.key="OD":b.key="[D";break;case 39:c?(b.key="[1;"+(c+1)+"C","[1;3C"==b.key&&(b.key="[1;5C")):this.applicationCursor?b.key="OC":b.key="[C";break;case 38:c?(b.key="[1;"+(c+1)+"A","[1;3A"==b.key&&(b.key="[1;5A")):this.applicationCursor?b.key="OA":b.key="[A";break;case 40:c?(b.key="[1;"+(c+1)+"B","[1;3B"==b.key&&(b.key="[1;5B")):this.applicationCursor?b.key="OB":b.key="[B";break;case 45:a.shiftKey||a.ctrlKey||(b.key="[2~");break;case 46:b.key="[3~";break;case 36:c?b.key="[1;"+(c+1)+"H":this.applicationCursor?b.key="OH":b.key="[H";break;case 35:c?b.key="[1;"+(c+1)+"F":this.applicationCursor?b.key="OF":b.key="[F";break;case 33:a.shiftKey?b.scrollDisp=-(this.rows-1):b.key="[5~";break;case 34:a.shiftKey?b.scrollDisp=this.rows-1:b.key="[6~";break;case 112:b.key="OP";break;case 113:b.key="OQ";break;case 114:b.key="OR";break;case 115:b.key="OS";break;case 116:b.key="[15~";break;case 117:b.key="[17~";break;case 118:b.key="[18~";break;case 119:b.key="[19~";break;case 120:b.key="[20~";break;case 121:b.key="[21~";break;case 122:b.key="[23~";break;case 123:b.key="[24~";break;default:!a.ctrlKey||a.shiftKey||a.altKey||a.metaKey?this.isMac||!a.altKey||a.ctrlKey||a.metaKey||(a.keyCode>=65&&a.keyCode<=90?b.key=""+w.fromCharCode(a.keyCode+32):192===a.keyCode?b.key="`":a.keyCode>=48&&a.keyCode<=57&&(b.key=""+(a.keyCode-48))):a.keyCode>=65&&a.keyCode<=90?b.key=w.fromCharCode(a.keyCode-64):32===a.keyCode?b.key=w.fromCharCode(0):a.keyCode>=51&&a.keyCode<=55?b.key=w.fromCharCode(a.keyCode-51+27):56===a.keyCode?b.key=w.fromCharCode(127):219===a.keyCode?b.key=w.fromCharCode(27):221===a.keyCode&&(b.key=w.fromCharCode(29))}return b},d.prototype.setgLevel=function(a){this.glevel=a,this.charset=this.charsets[a]},d.prototype.setgCharset=function(a,b){this.charsets[a]=b,this.glevel===a&&(this.charset=b)},d.prototype.keyPress=function(a){var b;if(this.cancel(a),a.charCode)b=a.charCode;else if(null==a.which)b=a.keyCode;else{if(0===a.which||0===a.charCode)return!1;b=a.which}return!(!b||(a.altKey||a.ctrlKey||a.metaKey)&&!k(this,a))&&(b=w.fromCharCode(b),this.emit("keypress",b,a),this.emit("key",b,a),this.showCursor(),this.handler(b),!1)},d.prototype.send=function(a){var b=this;this.queue||x(function(){b.handler(b.queue),b.queue=""},1),this.queue+=a},d.prototype.bell=function(){if(this.visualBell){var a=this;this.element.style.borderColor="white",x(function(){a.element.style.borderColor=""},10),this.popOnBell&&this.focus()}},d.prototype.log=function(){if(this.debug&&this.context.console&&this.context.console.log){var a=Array.prototype.slice.call(arguments);this.context.console.log.apply(this.context.console,a)}},d.prototype.error=function(){if(this.debug&&this.context.console&&this.context.console.error){var a=Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,a)}},d.prototype.resize=function(a,b){var c,d,e,f,g;if(a!==this.cols||b!==this.rows){if(a<1&&(a=1),b<1&&(b=1),e=this.cols,e<a)for(f=[this.defAttr," ",1],d=this.lines.length;d--;)for(;this.lines[d].length<a;)this.lines[d].push(f);else for(d=this.lines.length;d--;)for(;this.lines[d].length>a;)this.lines[d].pop();if(this.setupStops(e),this.cols=a,e=this.rows,g=0,e<b)for(c=this.element;e++<b;)this.lines.length<b+this.ybase&&(this.ybase>0&&this.lines.length<=this.ybase+this.y+g+1?(this.ybase--,g++,this.ydisp>0&&this.ydisp--):this.lines.push(this.blankLine())),this.children.length<b&&this.insertRow();else for(;e-- >b;)if(this.lines.length>b+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++)),this.children.length>b){
if(c=this.children.shift(),!c)continue;c.parentNode.removeChild(c)}this.rows=b,this.y>=b&&(this.y=b-1),g&&(this.y+=g),this.x>=a&&(this.x=a-1),this.scrollTop=0,this.scrollBottom=b-1,this.refresh(0,this.rows-1),this.normal=null,this.emit("resize",{terminal:this,cols:a,rows:b})}},d.prototype.updateRange=function(a){a<this.refreshStart&&(this.refreshStart=a),a>this.refreshEnd&&(this.refreshEnd=a)},d.prototype.maxRange=function(){this.refreshStart=0,this.refreshEnd=this.rows-1},d.prototype.setupStops=function(a){for(null!=a?this.tabs[a]||(a=this.prevStop(a)):(this.tabs={},a=0);a<this.cols;a+=8)this.tabs[a]=!0},d.prototype.prevStop=function(a){for(null==a&&(a=this.x);!this.tabs[--a]&&a>0;);return a>=this.cols?this.cols-1:a<0?0:a},d.prototype.nextStop=function(a){for(null==a&&(a=this.x);!this.tabs[++a]&&a<this.cols;);return a>=this.cols?this.cols-1:a<0?0:a},d.prototype.eraseRight=function(a,b){for(var c=this.lines[this.ybase+b],d=[this.eraseAttr()," ",1];a<this.cols;a++)c[a]=d;this.updateRange(b)},d.prototype.eraseLeft=function(a,b){var c=this.lines[this.ybase+b],d=[this.eraseAttr()," ",1];for(a++;a--;)c[a]=d;this.updateRange(b)},d.prototype.eraseLine=function(a){this.eraseRight(0,a)},d.prototype.blankLine=function(a){for(var b=a?this.eraseAttr():this.defAttr,c=[b," ",1],d=[],e=0;e<this.cols;e++)d[e]=c;return d},d.prototype.ch=function(a){return a?[this.eraseAttr()," ",1]:[this.defAttr," ",1]},d.prototype.is=function(a){var b=this.termName;return 0===(b+"").indexOf(a)},d.prototype.handler=function(a){this.emit("data",a)},d.prototype.handleTitle=function(a){this.emit("title",a)},d.prototype.index=function(){this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll()),this.state=p},d.prototype.reverseIndex=function(){var a;this.y--,this.y<this.scrollTop&&(this.y++,this.lines.splice(this.y+this.ybase,0,this.blankLine(!0)),a=this.rows-1-this.scrollBottom,this.lines.splice(this.rows-1+this.ybase-a+1,1),this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)),this.state=p},d.prototype.reset=function(){this.options.rows=this.rows,this.options.cols=this.cols;var a=this.customKeydownHandler;d.call(this,this.options),this.customKeydownHandler=a,this.refresh(0,this.rows-1)},d.prototype.tabSet=function(){this.tabs[this.x]=!0,this.state=p},d.prototype.cursorUp=function(a){var b=a[0];b<1&&(b=1),this.y-=b,this.y<0&&(this.y=0)},d.prototype.cursorDown=function(a){var b=a[0];b<1&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1)},d.prototype.cursorForward=function(a){var b=a[0];b<1&&(b=1),this.x+=b,this.x>=this.cols&&(this.x=this.cols-1)},d.prototype.cursorBackward=function(a){var b=a[0];b<1&&(b=1),this.x-=b,this.x<0&&(this.x=0)},d.prototype.cursorPos=function(a){var b,c;b=a[0]-1,c=a.length>=2?a[1]-1:0,b<0?b=0:b>=this.rows&&(b=this.rows-1),c<0?c=0:c>=this.cols&&(c=this.cols-1),this.x=c,this.y=b},d.prototype.eraseInDisplay=function(a){var b;switch(a[0]){case 0:for(this.eraseRight(this.x,this.y),b=this.y+1;b<this.rows;b++)this.eraseLine(b);break;case 1:for(this.eraseLeft(this.x,this.y),b=this.y;b--;)this.eraseLine(b);break;case 2:for(b=this.rows;b--;)this.eraseLine(b);break;case 3:}},d.prototype.eraseInLine=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y)}},d.prototype.charAttributes=function(a){if(1===a.length&&0===a[0])return void(this.curAttr=this.defAttr);for(var b,c=a.length,d=0,e=this.curAttr>>18,f=this.curAttr>>9&511,g=511&this.curAttr;d<c;d++)b=a[d],b>=30&&b<=37?f=b-30:b>=40&&b<=47?g=b-40:b>=90&&b<=97?(b+=8,f=b-90):b>=100&&b<=107?(b+=8,g=b-100):0===b?(e=this.defAttr>>18,f=this.defAttr>>9&511,g=511&this.defAttr):1===b?e|=1:4===b?e|=2:5===b?e|=4:7===b?e|=8:8===b?e|=16:22===b?e&=-2:24===b?e&=-3:25===b?e&=-5:27===b?e&=-9:28===b?e&=-17:39===b?f=this.defAttr>>9&511:49===b?g=511&this.defAttr:38===b?2===a[d+1]?(d+=2,f=l(255&a[d],255&a[d+1],255&a[d+2]),f===-1&&(f=511),d+=2):5===a[d+1]&&(d+=2,b=255&a[d],f=b):48===b?2===a[d+1]?(d+=2,g=l(255&a[d],255&a[d+1],255&a[d+2]),g===-1&&(g=511),d+=2):5===a[d+1]&&(d+=2,b=255&a[d],g=b):100===b?(f=this.defAttr>>9&511,g=511&this.defAttr):this.error("Unknown SGR attribute: %d.",b);this.curAttr=e<<18|f<<9|g},d.prototype.deviceStatus=function(a){if(this.prefix){if("?"===this.prefix)switch(a[0]){case 6:this.send("[?"+(this.y+1)+";"+(this.x+1)+"R");break;case 15:break;case 25:break;case 26:break;case 53:}}else switch(a[0]){case 5:this.send("[0n");break;case 6:this.send("["+(this.y+1)+";"+(this.x+1)+"R")}},d.prototype.insertChars=function(a){var b,c,d,e;for(b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.x,e=[this.eraseAttr()," ",1];b--&&d<this.cols;)this.lines[c].splice(d++,0,e),this.lines[c].pop()},d.prototype.cursorNextLine=function(a){var b=a[0];b<1&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1),this.x=0},d.prototype.cursorPrecedingLine=function(a){var b=a[0];b<1&&(b=1),this.y-=b,this.y<0&&(this.y=0),this.x=0},d.prototype.cursorCharAbsolute=function(a){var b=a[0];b<1&&(b=1),this.x=b-1},d.prototype.insertLines=function(a){var b,c,d;for(b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.rows-1-this.scrollBottom,d=this.rows-1+this.ybase-d+1;b--;)this.lines.splice(c,0,this.blankLine(!0)),this.lines.splice(d,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},d.prototype.deleteLines=function(a){var b,c,d;for(b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.rows-1-this.scrollBottom,d=this.rows-1+this.ybase-d;b--;)this.lines.splice(d+1,0,this.blankLine(!0)),this.lines.splice(c,1);this.updateRange(this.y),this.updateRange(this.scrollBottom)},d.prototype.deleteChars=function(a){var b,c,d;for(b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=[this.eraseAttr()," ",1];b--;)this.lines[c].splice(this.x,1),this.lines[c].push(d)},d.prototype.eraseChars=function(a){var b,c,d,e;for(b=a[0],b<1&&(b=1),c=this.y+this.ybase,d=this.x,e=[this.eraseAttr()," ",1];b--&&d<this.cols;)this.lines[c][d++]=e},d.prototype.charPosAbsolute=function(a){var b=a[0];b<1&&(b=1),this.x=b-1,this.x>=this.cols&&(this.x=this.cols-1)},d.prototype.HPositionRelative=function(a){var b=a[0];b<1&&(b=1),this.x+=b,this.x>=this.cols&&(this.x=this.cols-1)},d.prototype.sendDeviceAttributes=function(a){a[0]>0||(this.prefix?">"===this.prefix&&(this.is("xterm")?this.send("[>0;276;0c"):this.is("rxvt-unicode")?this.send("[>85;95;0c"):this.is("linux")?this.send(a[0]+"c"):this.is("screen")&&this.send("[>83;40003;0c")):this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")?this.send("[?1;2c"):this.is("linux")&&this.send("[?6c"))},d.prototype.linePosAbsolute=function(a){var b=a[0];b<1&&(b=1),this.y=b-1,this.y>=this.rows&&(this.y=this.rows-1)},d.prototype.VPositionRelative=function(a){var b=a[0];b<1&&(b=1),this.y+=b,this.y>=this.rows&&(this.y=this.rows-1)},d.prototype.HVPosition=function(a){a[0]<1&&(a[0]=1),a[1]<1&&(a[1]=1),this.y=a[0]-1,this.y>=this.rows&&(this.y=this.rows-1),this.x=a[1]-1,this.x>=this.cols&&(this.x=this.cols-1)},d.prototype.setMode=function(a){if("object"!=typeof a)if(this.prefix){if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!0;break;case 2:this.setgCharset(0,d.charsets.US),this.setgCharset(1,d.charsets.US),this.setgCharset(2,d.charsets.US),this.setgCharset(3,d.charsets.US);break;case 3:this.savedCols=this.cols,this.resize(132,this.rows);break;case 6:this.originMode=!0;break;case 7:this.wraparoundMode=!0;break;case 12:break;case 66:this.log("Serial port requested application keypad."),this.applicationKeypad=!0,this.viewport.setApplicationMode(!0);break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=9===a,this.vt200Mouse=1e3===a,this.normalMouse=a>1e3,this.mouseEvents=!0,this.element.style.cursor="default",this.log("Binding to mouse events.");break;case 1004:this.sendFocus=!0;break;case 1005:this.utfMouse=!0;break;case 1006:this.sgrMouse=!0;break;case 1015:this.urxvtMouse=!0;break;case 25:this.cursorHidden=!1;break;case 1049:case 47:case 1047:if(!this.normal){var b={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs};this.reset(),this.normal=b,this.showCursor()}}}else switch(a){case 4:this.insertMode=!0;break;case 20:}else for(var c=a.length,e=0;e<c;e++)this.setMode(a[e])},d.prototype.resetMode=function(a){if("object"!=typeof a)if(this.prefix){if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!1;break;case 3:132===this.cols&&this.savedCols&&this.resize(this.savedCols,this.rows),delete this.savedCols;break;case 6:this.originMode=!1;break;case 7:this.wraparoundMode=!1;break;case 12:break;case 66:this.log("Switching back to normal keypad."),this.viewport.setApplicationMode(!1),this.applicationKeypad=!1;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=!1,this.vt200Mouse=!1,this.normalMouse=!1,this.mouseEvents=!1,this.element.style.cursor="";break;case 1004:this.sendFocus=!1;break;case 1005:this.utfMouse=!1;break;case 1006:this.sgrMouse=!1;break;case 1015:this.urxvtMouse=!1;break;case 25:this.cursorHidden=!0;break;case 1049:case 47:case 1047:this.normal&&(this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),this.showCursor())}}else switch(a){case 4:this.insertMode=!1;break;case 20:}else for(var b=a.length,c=0;c<b;c++)this.resetMode(a[c])},d.prototype.setScrollRegion=function(a){this.prefix||(this.scrollTop=(a[0]||1)-1,this.scrollBottom=(a[1]||this.rows)-1,this.x=0,this.y=0)},d.prototype.saveCursor=function(a){this.savedX=this.x,this.savedY=this.y},d.prototype.restoreCursor=function(a){this.x=this.savedX||0,this.y=this.savedY||0},d.prototype.cursorForwardTab=function(a){for(var b=a[0]||1;b--;)this.x=this.nextStop()},d.prototype.scrollUp=function(a){for(var b=a[0]||1;b--;)this.lines.splice(this.ybase+this.scrollTop,1),this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},d.prototype.scrollDown=function(a){for(var b=a[0]||1;b--;)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());this.updateRange(this.scrollTop),this.updateRange(this.scrollBottom)},d.prototype.initMouseTracking=function(a){},d.prototype.resetTitleModes=function(a){},d.prototype.cursorBackwardTab=function(a){for(var b=a[0]||1;b--;)this.x=this.prevStop()},d.prototype.repeatPrecedingCharacter=function(a){for(var b=a[0]||1,c=this.lines[this.ybase+this.y],d=c[this.x-1]||[this.defAttr," ",1];b--;)c[this.x++]=d},d.prototype.tabClear=function(a){var b=a[0];b<=0?delete this.tabs[this.x]:3===b&&(this.tabs={})},d.prototype.mediaCopy=function(a){},d.prototype.setResources=function(a){},d.prototype.disableModifiers=function(a){},d.prototype.setPointerMode=function(a){},d.prototype.softReset=function(a){this.cursorHidden=!1,this.insertMode=!1,this.originMode=!1,this.wraparoundMode=!1,this.applicationKeypad=!1,this.applicationCursor=!1,this.scrollTop=0,this.scrollBottom=this.rows-1,this.curAttr=this.defAttr,this.x=this.y=0,this.charset=null,this.glevel=0,this.charsets=[null]},d.prototype.requestAnsiMode=function(a){},d.prototype.requestPrivateMode=function(a){},d.prototype.setConformanceLevel=function(a){},d.prototype.loadLEDs=function(a){},d.prototype.setCursorStyle=function(a){},d.prototype.setCharProtectionAttr=function(a){},d.prototype.restorePrivateValues=function(a){},d.prototype.setAttrInRectangle=function(a){for(var b,c,d=a[0],e=a[1],f=a[2],g=a[3],h=a[4];d<f+1;d++)for(b=this.lines[this.ybase+d],c=e;c<g;c++)b[c]=[h,b[c][1]];this.updateRange(a[0]),this.updateRange(a[2])},d.prototype.fillRectangle=function(a){for(var b,c,d=a[0],e=a[1],f=a[2],g=a[3],h=a[4];e<g+1;e++)for(b=this.lines[this.ybase+e],c=f;c<h;c++)b[c]=[b[c][0],w.fromCharCode(d)];this.updateRange(a[1]),this.updateRange(a[3])},d.prototype.enableLocatorReporting=function(a){a[0]>0},d.prototype.eraseRectangle=function(a){var b,c,d,e=a[0],f=a[1],g=a[2],h=a[3];for(d=[this.eraseAttr()," ",1];e<g+1;e++)for(b=this.lines[this.ybase+e],c=f;c<h;c++)b[c]=d;this.updateRange(a[0]),this.updateRange(a[2])},d.prototype.insertColumns=function(){for(var a,b=params[0],c=this.ybase+this.rows,d=[this.eraseAttr()," ",1];b--;)for(a=this.ybase;a<c;a++)this.lines[a].splice(this.x+1,0,d),this.lines[a].pop();this.maxRange()},d.prototype.deleteColumns=function(){for(var a,b=params[0],c=this.ybase+this.rows,d=[this.eraseAttr()," ",1];b--;)for(a=this.ybase;a<c;a++)this.lines[a].splice(this.x,1),this.lines[a].push(d);this.maxRange()},d.charsets={},d.charsets.SCLD={"`":"◆",a:"▒",b:"\t",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"\v",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},d.charsets.UK=null,d.charsets.US=null,d.charsets.Dutch=null,d.charsets.Finnish=null,d.charsets.French=null,d.charsets.FrenchCanadian=null,d.charsets.German=null,d.charsets.Italian=null,d.charsets.NorwegianDanish=null,d.charsets.Spanish=null,d.charsets.Swedish=null,d.charsets.Swiss=null,d.charsets.ISOLatin=null;var w=this.String,x=this.setTimeout;this.setInterval;l._cache={},l.distance=function(a,b,c,d,e,f){return Math.pow(30*(a-d),2)+Math.pow(59*(b-e),2)+Math.pow(11*(c-f),2)};var y=function(a){function b(a){var b,c=0,e=d.length-1;if(a<d[0][0]||a>d[e][1])return!1;for(;e>=c;)if(b=Math.floor((c+e)/2),a>d[b][1])c=b+1;else{if(!(a<d[b][0]))return!0;e=b-1}return!1}function c(c){return 0===c?a.nul:c<32||c>=127&&c<160?a.control:b(c)?0:1+(c>=4352&&(c<=4447||9001==c||9002==c||c>=11904&&c<=42191&&12351!=c||c>=44032&&c<=55203||c>=63744&&c<=64255||c>=65040&&c<=65049||c>=65072&&c<=65135||c>=65280&&c<=65376||c>=65504&&c<=65510||c>=131072&&c<=196605||c>=196608&&c<=262141))}var d=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];return c}({nul:0,control:0});return d.EventEmitter=a,d.CompositionHelper=b,d.Viewport=c,d.inherits=i,d.on=f,d.off=g,d.cancel=h,d});